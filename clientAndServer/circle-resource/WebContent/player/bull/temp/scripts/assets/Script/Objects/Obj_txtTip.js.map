{"version":3,"sources":["assets\\Script\\Objects\\Obj_txtTip.js"],"names":["cc","Class","extends","Component","properties","_maxCountDown","_curCountDown","_callBack","_curBaseStr","_tipIndex","_tipMgr","_widthRate","_hideFunc","node_centerLabel","Node","onLoad","_init","_mainLabel","getComponent","Label","_defaultTime","G_Config_common","time_tipDefault","bindMgr","mgr","showTip","dataObj","retainTime","tipIndex","table","G_DATA","getChinese","content","node","active","pos","showPos","getCenterTipPos","position","showByOpacity","showStr","isNaN","Math","max","callBack","formatStr","isCountDown","_hideTip","_addCountDown","_resetBackground","G_TOOL","_showTxt","act1","fadeOut","runAction","sequence","callFunc","_clearTxtTip","forceChangeStr","changeStr","forceChangeCountDown","num","forceEnd","unschedule","let_update","resetTxtAndTime","time","stopAllActions","opacity","hideByOpacity","string","str","width","length","maxTime","_countDownEnd","_interval","schedule","dt","bindHideFunc","func","oneTipHide","getIsShow","setIsShow","isShow","getTipIndex","onDestroy"],"mappings":"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","file":"unknown","sourcesContent":["//显示在屏幕中央的文字提示\r\n\r\n//var dataObj = {\r\n//    tipIndex : 1,\r\n//    showStr : '',\r\n//    formatStr : '',\r\n//    showPos : cc.p(0,0),\r\n//    retainTime : 5,\r\n//    isCountDown : false,\r\n//    isRepeat : false,\r\n//    callBack : 'target'\r\n//}\r\n\r\ncc.Class({\r\n    extends: cc.Component,\r\n    properties: {\r\n        _maxCountDown : null,                           //最大倒计时\r\n        _curCountDown : null,                           //剩余时间\r\n        _callBack : null,                               //倒计时结束后的回调\r\n        _curBaseStr : null,                             //显示的文字基础\r\n        _tipIndex : null,                               //tip索引\r\n        _tipMgr : null,                                 //管理器\r\n        _widthRate : null,\r\n        _hideFunc : null,\r\n\r\n        node_centerLabel : cc.Node,                     //\r\n    },\r\n\r\n    // use this for initialization\r\n    onLoad: function () {\r\n        this._init();\r\n    },\r\n\r\n    _init : function () {\r\n        this._mainLabel = this.node_centerLabel.getComponent(cc.Label);\r\n        this._defaultTime = G_Config_common.time_tipDefault;\r\n    },\r\n\r\n    bindMgr : function (mgr) {\r\n        this._tipMgr = mgr;\r\n    },\r\n\r\n    //==========================================\r\n\r\n    showTip : function (dataObj) {\r\n        //this.forceEnd();\r\n        var retainTime;\r\n        if(dataObj.tipIndex){\r\n            var table = G_DATA.getChinese(dataObj.tipIndex);\r\n            if(table){\r\n                this._curBaseStr = table.content;\r\n                retainTime = table.retainTime;\r\n            }\r\n        }\r\n        this.node.active = true;\r\n        var pos = dataObj.showPos;\r\n        if(!pos) pos = G_DATA.getCenterTipPos();\r\n        this.node.position = pos;\r\n        this.showByOpacity();\r\n\r\n        if(dataObj.showStr) this._curBaseStr = dataObj.showStr;\r\n        if(!isNaN(dataObj.retainTime)) {\r\n            retainTime = Math.max(dataObj.retainTime, 0);\r\n        }\r\n        this._callBack = dataObj.callBack;\r\n        var formatStr = dataObj.formatStr;\r\n        this._tipIndex = dataObj.tipIndex;\r\n\r\n        if(dataObj.isCountDown){\r\n            if(!retainTime) {\r\n                this._hideTip();\r\n                if(this._callBack){\r\n                    this._callBack();\r\n                    this._callBack = null;\r\n                }\r\n                return;\r\n            }\r\n            this._addCountDown(retainTime);\r\n            this._resetBackground(G_TOOL.formatStr(this._curBaseStr, 123));\r\n        }else {\r\n            if(!retainTime) retainTime = this._defaultTime;\r\n            this._showTxt();\r\n            this._resetBackground(G_TOOL.formatStr(this._curBaseStr, formatStr));\r\n            var act1 = cc.fadeOut(retainTime);\r\n            this.node.runAction(cc.sequence(act1, cc.callFunc(this._clearTxtTip, this)));\r\n        }\r\n    },\r\n    //中途修改显示文字\r\n    forceChangeStr : function (changeStr) {\r\n        this._curBaseStr = changeStr;\r\n        this._resetBackground(G_TOOL.formatStr(this._curBaseStr, ''));\r\n    },\r\n    //中途修改显示倒计时的数值\r\n    forceChangeCountDown : function (num) {\r\n        this._maxCountDown = num;\r\n        this._curCountDown = this._maxCountDown;\r\n        this._showTxt(this._curCountDown);\r\n    },\r\n    //强制结束倒计时\r\n    forceEnd : function () {\r\n        if(this._curCountDown) this.unschedule(this.let_update);\r\n        this._curCountDown = 0;\r\n        this._callBack = null;\r\n        this._hideTip();\r\n    },\r\n    //重置显示内容和时间\r\n    resetTxtAndTime : function (content, time) {\r\n        if(!time) time = this._defaultTime;\r\n        this.node.stopAllActions();\r\n\r\n        this._curBaseStr = content;\r\n        this._showTxt();\r\n        this._resetBackground(G_TOOL.formatStr(this._curBaseStr, ''));\r\n        var act1 = cc.fadeOut(time);\r\n        this.node.runAction(cc.sequence(act1, cc.callFunc(this._clearTxtTip, this)));\r\n    },\r\n\r\n    showByOpacity : function () {\r\n        this.node.opacity = 255;\r\n    },\r\n    hideByOpacity : function () {\r\n        this.node.opacity = 0;\r\n    },\r\n\r\n    _showTxt : function (formatStr) {\r\n        if(!formatStr) this._mainLabel.string = this._curBaseStr;\r\n        else this._mainLabel.string = G_TOOL.formatStr(this._curBaseStr, formatStr);\r\n    },\r\n\r\n    _resetBackground : function (str) {\r\n        if(!this._widthRate) this._widthRate = this.node.width/13;\r\n        this.node.width = str.length * this._widthRate;\r\n    },\r\n\r\n    _addCountDown : function (maxTime) {\r\n        if(this._curCountDown) this._countDownEnd();\r\n        this._maxCountDown = maxTime;\r\n        this._curCountDown = this._maxCountDown;\r\n        this._interval = 1.0;\r\n        this.schedule(this.let_update, this._interval);\r\n        this._showTxt(this._curCountDown);\r\n    },\r\n\r\n    _countDownEnd : function () {\r\n        this.unschedule(this.let_update);\r\n        this._clearTxtTip();\r\n    },\r\n    //frame\r\n    let_update : function (dt) {\r\n        if(this._curCountDown > 0){\r\n            this._curCountDown -= 1;\r\n            this._showTxt(this._curCountDown);\r\n            if(this._curCountDown <= 0) {\r\n                //倒计时结束\r\n                this._countDownEnd();\r\n            }\r\n        }\r\n    },\r\n\r\n    _clearTxtTip : function () {\r\n        if(this._callBack) {\r\n            this._callBack();\r\n            this._callBack = null;\r\n        }\r\n        this._hideTip();\r\n    },\r\n\r\n    //==========================================\r\n\r\n    //绑定消失函数\r\n    bindHideFunc : function (func) {\r\n        this._hideFunc = func;\r\n    },\r\n\r\n    _hideTip : function () {\r\n        this._tipMgr.oneTipHide(this.node);\r\n        this.node.active = false;\r\n        if(this._hideFunc){\r\n            this._hideFunc();\r\n            this._hideFunc = null;\r\n        }\r\n    },\r\n\r\n    //是否已经在显示了\r\n    getIsShow : function () {\r\n        return this.node.active\r\n    },\r\n    setIsShow : function (isShow) {\r\n        this.node.active = isShow;\r\n    },\r\n\r\n    //获取该tip的表格索引\r\n    getTipIndex : function () {\r\n        return this._tipIndex\r\n    },\r\n\r\n    onDestroy : function () {\r\n        if(this._curCountDown) this.unschedule(this.let_update);\r\n    },\r\n\r\n    // called every frame, uncomment this function to activate update callback\r\n    // update: function (dt) {\r\n    //\r\n    // },\r\n});\r\n"]}