{"version":3,"sources":["assets\\Script\\Objects\\Obj_dealScroll.js"],"names":["dataObj","itemPrefab","lineNum","scrollType","cc","Class","extends","Component","properties","_itemPrefab","_showItemNum","_itemHeight","_itemWidth","_itemOffX","_itemOffY","_pool","_scrollType","_viewW2","_lineNum","onLoad","setData","_initData","G_TYPE","vertical","node","parent","width","addOneItem","item","_getOnePoolNode","y","horizontal","startPosX","x","bag","rowNum","Math","floor","_resetContainerSize","getItemByIndex","index","items","children","getAllItems","clearItems","i","length","_removePoolNode","setContentSize","height","NodePool","name","cNode","get","instantiate","active","put","contentH","contentW","ceil","getShowItemNum","getScrollView","getComponent","ScrollView","registerBottomEvent","getNextPageList","dataList","intervalNum","splice","getPageNoByNum","itemNum","firstNum","pageNo","scrollToUp","scrollToTop","onDestroy","clear"],"mappings":"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","file":"unknown","sourcesContent":["//自动处理滚动层逻辑\r\n\r\nvar dataObj = {\r\n    itemPrefab : null,\r\n    lineNum : null,\r\n    scrollType : null,\r\n}\r\n\r\n\r\ncc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        _itemPrefab : null,                                                                                             //条目的复制体\r\n        _showItemNum : null,                                                                                             //显示的条目数量\r\n        _itemHeight : null,                                                                                              //条目的高度\r\n        _itemWidth : null,                                                                                               //条目的宽度\r\n        _itemOffX : null,                                                                                                //条目之间的间隔\r\n        _itemOffY : null,                                                                                                //条目之间的间隔\r\n        _pool : null,                                                                                                     //对象池\r\n        _scrollType : null,                                                                                              //滚动容器的类型\r\n        _viewW2 : null,                                                                                                   //可视区域宽度的一半\r\n        //背包类型需要用到的属性\r\n        _lineNum : null,                                                                                                  //每一行的单元数量\r\n    },\r\n\r\n    // use this for initialization\r\n    onLoad: function () {\r\n        this._itemOffY = 0;\r\n        this._itemOffX = 0;\r\n    },\r\n\r\n    setData : function (dataObj) {\r\n        this._initData();\r\n        this._itemPrefab = dataObj.itemPrefab;\r\n        this._lineNum = dataObj.lineNum;\r\n        this._scrollType = dataObj.scrollType;\r\n        //默认类型\r\n        if(!this._scrollType) this._scrollType = G_TYPE.scrollType.vertical;\r\n    },\r\n    _initData : function () {\r\n        this._showItemNum = 0;\r\n        this._itemHeight = null;\r\n        this._itemWidth = null;\r\n        if(!this._viewW2) this._viewW2 = this.node.parent.width*0.5;\r\n    },\r\n\r\n    //添加一个条目\r\n    addOneItem : function () {\r\n        var item = this._getOnePoolNode();\r\n\r\n        switch (this._scrollType){\r\n            case G_TYPE.scrollType.vertical:\r\n                item.y = -this._showItemNum * (this._itemHeight + this._itemOffY);\r\n                break;\r\n            case G_TYPE.scrollType.horizontal://水平滚动层，需要去掉水平方向的widget\r\n                var startPosX = -this._viewW2;\r\n                item.x = startPosX + this._showItemNum * (this._itemWidth + this._itemOffY);\r\n                break;\r\n            case G_TYPE.scrollType.bag:\r\n                var startPosX = -this._viewW2;\r\n                var lineNum;\r\n                if(this._showItemNum == 0) lineNum = 0;\r\n                else lineNum = this._showItemNum%this._lineNum;\r\n                var rowNum = Math.floor(this._showItemNum/this._lineNum);\r\n                item.x = startPosX + lineNum * (this._itemWidth + this._itemOffY) + this._itemWidth/2;\r\n                item.y = -rowNum * (this._itemHeight + this._itemOffX);\r\n                break;\r\n            default:\r\n                break;\r\n        }\r\n\r\n        this._showItemNum += 1;\r\n        this._resetContainerSize();\r\n        return item\r\n    },\r\n\r\n    //获取某个条目(从0开始)\r\n    getItemByIndex : function (index) {\r\n        var items = this.node.children;\r\n        var item = items[index];\r\n        if(item) return item;\r\n        return this.addOneItem();\r\n    },\r\n\r\n    //获取所有的条目\r\n    getAllItems : function () {\r\n        return this.node.children;\r\n    },\r\n\r\n    //清理条目（从0开始，清理index之后的条目, 不包括index）\r\n    clearItems : function (index) {\r\n        var items = this.node.children;\r\n        for(var i = items.length-1; i > index; i --){\r\n            if(items[i]) this._removePoolNode(items[i]);\r\n        }\r\n    },\r\n\r\n    //直接设置容器的大小\r\n    setContentSize : function (width, height) {\r\n        if(width) this.node.width = width;\r\n        if(height) this.node.height = height;\r\n    },\r\n\r\n    //=====================================================\r\n\r\n    //获取一个条目\r\n    _getOnePoolNode : function () {\r\n        if(!this._itemPrefab) return null;\r\n        if(!this._pool) this._pool = new cc.NodePool('Obj_dealScroll'+this._itemPrefab.name);\r\n\r\n        var cNode = this._pool.get();\r\n        if(!cNode){\r\n            cNode = cc.instantiate(this._itemPrefab);\r\n            if(!this._itemHeight) this._itemHeight = cNode.height;\r\n            if(!this._itemWidth) this._itemWidth = cNode.width;\r\n        }\r\n        cNode.parent = this.node;\r\n        cNode.active = true;\r\n        return cNode;\r\n    },\r\n\r\n    _removePoolNode : function (cNode) {\r\n        // cNode.active = false;\r\n        this._pool.put(cNode);\r\n\r\n        this._showItemNum -= 1;\r\n        this._resetContainerSize();\r\n    },\r\n\r\n    _resetContainerSize : function () {\r\n        var contentH, contentW;\r\n        switch (this._scrollType){\r\n            case G_TYPE.scrollType.vertical:\r\n                contentW = this._itemWidth + this._itemOffX;\r\n                contentH = this._showItemNum * (this._itemHeight + this._itemOffY);\r\n                break;\r\n            case G_TYPE.scrollType.horizontal:\r\n                contentW = this._showItemNum * (this._itemWidth + this._itemOffX);\r\n                contentH = this._itemHeight + this._itemOffY;\r\n                break;\r\n            case G_TYPE.scrollType.bag:\r\n                contentW = this._lineNum * (this._itemWidth + this._itemOffX);\r\n                var rowNum = Math.ceil(this._showItemNum/this._lineNum);\r\n                contentH = rowNum * (this._itemHeight + this._itemOffY);\r\n                break;\r\n            default:\r\n                break;\r\n        }\r\n        this.node.height = contentH;\r\n        this.node.width = contentW;\r\n    },\r\n\r\n    //获取当前已经显示的条目数量\r\n    getShowItemNum : function () {\r\n        return this._showItemNum\r\n    },\r\n\r\n    //获取scrollview组件\r\n    getScrollView : function () {\r\n        return this.node.parent.parent.getComponent(cc.ScrollView)\r\n    },\r\n\r\n    //注册滚动到底部的事件\r\n    registerBottomEvent : function () {\r\n\r\n    },\r\n\r\n    //获取下一页的更新信息\r\n    getNextPageList : function (dataList, intervalNum) {\r\n        return dataList.splice(0,intervalNum);\r\n    },\r\n\r\n    //根据数量获取页数 从1开始\r\n    getPageNoByNum : function (itemNum, firstNum) {\r\n        var pageNo = Math.floor(itemNum / firstNum);\r\n        if(itemNum > pageNo * firstNum){\r\n            pageNo += 1;\r\n        }\r\n        return pageNo\r\n    },\r\n\r\n    scrollToUp : function () {\r\n        this.getScrollView().scrollToTop(0.2);\r\n    },\r\n\r\n    onDestroy : function () {\r\n        if(this._pool) this._pool.clear();\r\n    },\r\n\r\n    // called every frame, uncomment this function to activate update callback\r\n    // update: function (dt) {\r\n\r\n    // },\r\n});\r\n"]}