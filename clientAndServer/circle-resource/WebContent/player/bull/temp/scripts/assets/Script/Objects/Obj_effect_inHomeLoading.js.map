{"version":3,"sources":["assets\\Script\\Objects\\Obj_effect_inHomeLoading.js"],"names":["cc","Class","extends","require","properties","_maxProgress","_toSceneName","_loadingNum","_reConnectNum","label_tip","default","type","Label","displayName","label_rate","onLoad","_super","node","_firstPosY","y","_node_sliderImg","children","_firstMaxProgress","runTime","_curProgress","_progressInSec","_isStartEffect","start","GG","setIsLoading","_showSliderEffect","preloadedScene","_step_loadAudioConfig","self","audioMgr","getIsReloadGame","reloadGameAudio","_oneCompleted","reloadInfo","getPlayer","getReloadSceneInfo","sceneName","_addReloadScene","_addTip","_loadInitGameConfig","_whenReloadEnd","sys","garbageCollect","director","loadScene","clearInterval","inervalId","isFirst","whenGameStart","_addConfigCallFunc","G_Config_common","isLocal","_sendLogin","G_TYPE","platform","_doLogin","console","log","username","password","sendData","httpMgr","sendHttpRequest","G_DIALOG_URL","login","data","bind","getPlayerToken","loginTokenUrl","setPlayerToken","socketMgr","connectSocket","_whenLoginEnd","showReconnect","_step1_setPlayerInfo","_step2_setAudioConfig","_step3_setReloadScene","getBaseInfo","personalInfoUrl","setBaseInfo","getAudioConfig","getSystemSetUrl","config","code","result","setAudioConfig","hashData","G_DATA","getLastSceneHash","netData","roomId","gameModel","getEnterHomeModel","enterType","s_requestMgr","send_inHome","recvData","setCurSceneHash","getSceneName","preloadScene","table","tableMgr","getTable","G_RES_URL","dict_tablesName","grabConfig","dataObj","getFirstData","_addConfig","G_Config_grab","commonConfig","targetObject","addObject","attrName","_setSliderValue","rate","_setRateInfo","len","height","needH","_setTipInfo","str","string","Math","floor","update","dt","_playerSliderEffect","_table","commonLoading","_setLoadingTable","_showTableTime","reloadTables","_getLoadingTable","loadMessage","content","_getRandomTable","index","G_TOOL","getRandomArea","getDataByID","setInterval","onDestroy"],"mappings":"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","file":"unknown","sourcesContent":["//进入房间时候的加载动画\r\n\r\n\r\ncc.Class({\r\n    extends: require('BaseManager'),\r\n\r\n    properties: {\r\n        _maxProgress : null,                                                            //进度滚动的最大效果0-1\r\n        _toSceneName : null,                                                            //准备跳转的场景名字\r\n\r\n        _loadingNum : null,                                                             //正在加载的数量\r\n        _reConnectNum : null,                                                           //重连次数\r\n        label_tip : {\r\n            default : null,\r\n            type : cc.Label,\r\n            displayName : '加载时候的提示信息'\r\n        },\r\n        label_rate : {\r\n            default : null,\r\n            type : cc.Label,\r\n            displayName : '显示百分比'\r\n        }\r\n    },\r\n\r\n    // use this for initialization\r\n    onLoad: function () {\r\n        this._super();\r\n\r\n        this.node._firstPosY = this.node.y;\r\n        this._node_sliderImg = this.node.children[0];\r\n        this._node_sliderImg._firstPosY = this._node_sliderImg.y;\r\n\r\n        this._firstMaxProgress = 0.9;\r\n        var runTime = 2;\r\n        this._curProgress = 0;\r\n        this._loadingNum = 0;\r\n        this._reConnectNum = 0;\r\n        //每秒的进度\r\n        this._progressInSec = this._firstMaxProgress/runTime;\r\n        this._isStartEffect = false;\r\n    },\r\n\r\n    start : function () {\r\n        //进入加载状态\r\n        GG.setIsLoading(true);\r\n        //显示进度信息\r\n        this._showSliderEffect();\r\n        //加载即将进入的场景\r\n        this.preloadedScene();\r\n    },\r\n\r\n    _step_loadAudioConfig : function () {\r\n        var self = this;\r\n        if(!GG.audioMgr.getIsReloadGame()){\r\n            this._loadingNum += 1;\r\n            GG.audioMgr.reloadGameAudio(function () {\r\n                self._oneCompleted();\r\n            });\r\n        }\r\n    },\r\n\r\n    //预加载场景\r\n    preloadedScene : function () {\r\n        var reloadInfo = GG.getPlayer().getReloadSceneInfo();\r\n        if(reloadInfo && reloadInfo.sceneName){\r\n            //基本配置已经加载完\r\n            this._addReloadScene(reloadInfo.sceneName);\r\n            //提示文本\r\n            this._addTip();\r\n        }else{\r\n            //首次默认加载\r\n            this._loadInitGameConfig();\r\n        }\r\n    },\r\n    //有某个资源加载完成\r\n    _oneCompleted : function () {\r\n        this._loadingNum -= 1;\r\n        if(this._loadingNum <= 0){\r\n            //所有资源加载完成，且进度达到90%,则将进度特效播放到结束\r\n            this._firstMaxProgress = 1;\r\n            this._isStartEffect = true;\r\n        }\r\n    },\r\n\r\n    _whenReloadEnd : function () {\r\n        cc.sys.garbageCollect();\r\n        //进度已经走完\r\n        cc.director.loadScene(this._toSceneName);\r\n        clearInterval(this.inervalId);\r\n    },\r\n\r\n    //=========================\r\n\r\n    //加载初始配置\r\n    _loadInitGameConfig : function () {\r\n        var self = this;\r\n        this._loadingNum += 1;\r\n        var isFirst = GG.whenGameStart(function () {\r\n            self._addConfigCallFunc();\r\n            if(!G_Config_common.isLocal) {\r\n                self._sendLogin();\r\n                // self._doLogin();\r\n            }else {\r\n                self._toSceneName = G_TYPE.sceneName.platform;\r\n            }\r\n\r\n            //界面下方的提示文本\r\n            self._addTip();\r\n            self._oneCompleted();\r\n        });\r\n        if(!isFirst) {\r\n            self._oneCompleted();\r\n        }\r\n    },\r\n\r\n    //直接登录（测试）\r\n    _doLogin : function () {\r\n        console.log('发送登录请求')\r\n        var username = 'mk06';\r\n        var password = '1234567';\r\n        var sendData = 'username='+username+'&password='+password;\r\n        this._loadingNum += 1;\r\n        GG.httpMgr.sendHttpRequest(G_DIALOG_URL.login+\"?\"+sendData, null, function (data) {\r\n            console.log('接受到登录信息')\r\n            console.log(data)\r\n            // if(data){\r\n            //\r\n            // }\r\n            this._sendLogin();\r\n            this._oneCompleted();\r\n        }.bind(this), 'GET');\r\n    },\r\n\r\n    //发送登陆确认请求\r\n    _sendLogin : function () {\r\n        var sendData = null;\r\n        if(!GG.getPlayer().getPlayerToken()){\r\n            this._loadingNum += 1;\r\n            GG.httpMgr.sendHttpRequest(G_DIALOG_URL.loginTokenUrl, sendData, function (data) {\r\n                if(data){\r\n                    GG.getPlayer().setPlayerToken(data);\r\n                    this._reConnectNum = 0;\r\n                    this._loadingNum += 1;\r\n                    var self = this;\r\n                    //登陆socket\r\n                    GG.socketMgr.connectSocket(function () {\r\n                        self._whenLoginEnd();\r\n                        self._oneCompleted();\r\n                    });\r\n                }else {\r\n                    this._reConnectNum += 1;\r\n                    if(this._reConnectNum > 6){\r\n                        //重连次数太多\r\n                        var self = this;\r\n                        GG.showReconnect(function () {\r\n                            self._reConnectNum = 0;\r\n                            self._sendLogin();\r\n                        });\r\n                    }else this._sendLogin();\r\n                }\r\n                this._oneCompleted();\r\n            }.bind(this));\r\n        }else this._whenLoginEnd();\r\n    },\r\n    _whenLoginEnd : function () {\r\n        this._step1_setPlayerInfo();\r\n        this._step2_setAudioConfig();\r\n        this._step3_setReloadScene();\r\n    },\r\n    //获取玩家信息并放置M_Player脚本中\r\n    _step1_setPlayerInfo : function () {\r\n        var sendData = null;\r\n        if(!GG.getPlayer().getBaseInfo()){\r\n            this._loadingNum += 1;\r\n            GG.httpMgr.sendHttpRequest(G_DIALOG_URL.personalInfoUrl, sendData, function (data) {\r\n                GG.getPlayer().setBaseInfo(data);\r\n                this._oneCompleted();\r\n            }.bind(this));\r\n        }\r\n    },\r\n    //请求服务器声音的设置\r\n    _step2_setAudioConfig : function () {\r\n        if(!GG.audioMgr.getAudioConfig()){\r\n            this._loadingNum += 1;\r\n            //GG.httpMgr.sendHttpRequest(G_DIALOG_URL.loginToSetUrl, sendData, function (data) {\r\n            //    var config = data[0];\r\n            //    if(!data || data.length < 1){\r\n            //        config = {'music':true,'sound':true};\r\n            //    }\r\n            //    GG.audioMgr.setAudioConfig(config);\r\n            //    this._oneRequestEnd();\r\n            //}.bind(this));\r\n            GG.httpMgr.sendHttpRequest(G_DIALOG_URL.getSystemSetUrl, 'gameType=DOU_NIU', function (data) {\r\n                var config;\r\n                if(data){\r\n                    if(data.code == 0){\r\n                        config = {'music':true,'sound':true};\r\n                    } else {\r\n                        config = data.data.result[0];\r\n                    }\r\n                }else config = {'music':true,'sound':true};\r\n\r\n                //if(config.music && GG.audioMgr.getIsPlayMusic()) GG.audioMgr.saveSoundConfig(config.sound);\r\n                GG.audioMgr.setAudioConfig(config);\r\n                this._oneCompleted();\r\n            }.bind(this));\r\n        }\r\n    },\r\n    //登陆后，加载即将进入的场景\r\n    _step3_setReloadScene : function () {\r\n        var self = this;\r\n        //刚登陆，会根据hash来设置初始页面\r\n        var hashData = G_DATA.getLastSceneHash();\r\n        if(hashData){\r\n            var netData = {\r\n                roomId : hashData.roomId,\r\n                gameModel : G_DATA.getEnterHomeModel(hashData.enterType)\r\n            }\r\n            self._loadingNum += 1;\r\n            GG.s_requestMgr.send_inHome(netData, function (recvData) {\r\n                // GG.changeScene(G_DATA.getSceneName(hashData.enterType));\r\n                if(recvData){\r\n                    //记录hash信息\r\n                    G_DATA.setCurSceneHash(hashData.enterType,hashData.roomId);\r\n                    self._addReloadScene(G_DATA.getSceneName(hashData.enterType));\r\n                }else{\r\n                    //进房请求失败,回到主场景\r\n                    G_DATA.setCurSceneHash('',0);\r\n                    self._addReloadScene(G_TYPE.sceneName.platform);\r\n                }\r\n                self._oneCompleted();\r\n            })\r\n        }else{\r\n            //默认的场景\r\n            G_DATA.setCurSceneHash('',0);\r\n            this._addReloadScene(G_TYPE.sceneName.platform);\r\n        }\r\n    },\r\n    _addReloadScene : function (sceneName) {\r\n        this._toSceneName = sceneName;\r\n        this._loadingNum += 1;\r\n        var self = this;\r\n        cc.director.preloadScene(this._toSceneName, function () {\r\n            self._oneCompleted();\r\n        });\r\n        if(sceneName != G_TYPE.sceneName.platform){\r\n            //加载游戏房间内声音配置\r\n            this._step_loadAudioConfig();\r\n        }\r\n    },\r\n\r\n    //加载配置文件结束\r\n    _addConfigCallFunc : function () {\r\n        var table = GG.tableMgr.getTable(G_RES_URL.dict_tablesName.grabConfig);\r\n        if(table) {\r\n            var dataObj = table.getFirstData();\r\n            this._addConfig(G_Config_grab, dataObj);\r\n        }\r\n\r\n        var table = GG.tableMgr.getTable(G_RES_URL.dict_tablesName.commonConfig);\r\n        if(table) {\r\n            var dataObj = table.getFirstData();\r\n            this._addConfig(G_Config_common, dataObj);\r\n        }\r\n    },\r\n    //增加配置信息\r\n    _addConfig : function (targetObject, addObject) {\r\n        if(addObject){\r\n            for(var attrName in addObject){\r\n                targetObject[attrName] = addObject[attrName];\r\n            }\r\n        }\r\n    },\r\n\r\n    //================================进度条的表现\r\n\r\n    //开始进度条的显示，直接播放到90%等待\r\n    _showSliderEffect : function () {\r\n        this._loadingNum += 1;\r\n        this._curProgress = 0;\r\n        this._setSliderValue(this._curProgress);\r\n        this._isStartEffect = true;\r\n    },\r\n    //设置显示进度 0-1\r\n    _setSliderValue : function (rate) {\r\n        this._setRateInfo(rate);\r\n        var len = rate * this.node.height;\r\n        var needH = this.node.height - len;\r\n        this.node.y = -needH;\r\n        this._node_sliderImg.y = needH;\r\n    },\r\n    //设置提示信息\r\n    _setTipInfo : function (str) {\r\n        if(this.label_tip){\r\n            this.label_tip.string = str;\r\n        }\r\n    },\r\n    //设置百分比信息\r\n    _setRateInfo : function (rate) {\r\n        var str = Math.floor(rate * 100) + '%';\r\n        if(this.label_rate){\r\n            this.label_rate.string = str;\r\n        }\r\n    },\r\n\r\n    // called every frame, uncomment this function to activate update callback\r\n    update: function (dt) {\r\n        if(this._isStartEffect){\r\n            this._playerSliderEffect(dt);\r\n        }\r\n    },\r\n    //播放进度动画到90%\r\n    _playerSliderEffect : function (dt) {\r\n        if(this._curProgress >= this._firstMaxProgress) {\r\n            //达到第一阶段，如90%\r\n            this._isStartEffect = false;\r\n            this._oneCompleted();\r\n            return;\r\n        }\r\n        this._curProgress += dt * this._progressInSec;\r\n        this._setSliderValue(this._curProgress);\r\n        if(this._curProgress >= 1){\r\n            this._curProgress = 1;\r\n            this._setSliderValue(this._curProgress);\r\n            this._isStartEffect = false;\r\n\r\n            this._whenReloadEnd();\r\n        }\r\n    },\r\n\r\n    //==========================显示提示文本\r\n\r\n    //界面下方的提示文本\r\n    _addTip : function () {\r\n        this._table = GG.tableMgr.getTable(G_RES_URL.dict_tablesName.commonLoading);\r\n        if (!this._table) {\r\n            this._setLoadingTable();\r\n        } else {\r\n            this._showTableTime();\r\n        }\r\n    },\r\n\r\n    //设置文本表格\r\n    _setLoadingTable: function () {\r\n        GG.tableMgr.reloadTables(G_RES_URL.dict_tablesName.commonLoading, this._getLoadingTable.bind(this));\r\n    },\r\n    //获取文本表格\r\n    _getLoadingTable: function () {\r\n        this._table = GG.tableMgr.getTable(G_RES_URL.dict_tablesName.commonLoading);\r\n        if(this._table) {\r\n            var loadMessage = this._table.getFirstData().content;\r\n            this._setTipInfo(loadMessage);\r\n            this._showTableTime();\r\n        }\r\n    },\r\n    _getRandomTable: function () {\r\n        var index = G_TOOL.getRandomArea(1,7);\r\n        var loadMessage = this._table.getDataByID(index).content;\r\n        return loadMessage;\r\n    },\r\n    //定时显示\r\n    _showTableTime: function () {\r\n        var self = this;\r\n        this.inervalId = setInterval(function () {\r\n            self._setTipInfo(self._getRandomTable());\r\n        }, 2000);\r\n    },\r\n\r\n    onDestroy : function () {\r\n\r\n    },\r\n});\r\n"]}