{"version":3,"sources":["assets\\Script\\Views\\Scene_Platform\\Platform_Manager.js"],"names":["cc","Class","extends","require","properties","_dict_ui","_richRankData","_ui_baseUrl","_roomComp","_enterRoomCallFunc","_isFirstEnter","_reConnectNum","comp_uiContainer","type","displayName","comp_enterBtn","comp_leftRank","comp_bottomBtns","comp_topInfo","onLoad","_super","GG","platformMgr","_roomNode","start","_initMainScene","G_Config_common","isLocal","self","id","setInterval","tipsMgr","getAdIsLimit","addNotice","setRichData","setTimeout","showHomeList","initShow","dataObj","getPlayer","getOutHomeData","gameType","G_TYPE","gameModule","platform","showHomeListFirst","openUI","uiName","callBack","addUI","isOut","isNoEffect","moveOutScene","setHomeListShow","showLayer","setAdLimit","hideLayer","setHomeListInfo","data","setDataList","_addConfigCallFunc","table","tableMgr","getTable","G_RES_URL","dict_tablesName","grabConfig","getFirstData","_addConfig","G_Config_grab","commonConfig","targetObject","addObject","attrName","showRoomUI","prefabName","uiComp","G_DATA","getRoomListJson","loader","loadRes","err","prefab","uiNode","instantiate","parent","node","getComponent","releaseRoomUI","deps","getDependsRecursively","release","requestEnterRoom","netData","callFunc","socketMgr","SendMsg","NetType","s_enterHouse","registerLong","r_enterHouseReturn","net_setHomeData","bind","recvData","tip","code","serverCodeType","success","goldNotEnough","showConfirmTip_ONE","matchNoEnd","inHomeData","G_OBJ","data_inHomeData","net_inHomeData","setInHomeData","onDestroy"],"mappings":"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","file":"unknown","sourcesContent":["//大厅场景管理\r\n\r\ncc.Class({\r\n    extends: require('BaseManager'),\r\n    properties: {\r\n        _dict_ui : null,                                                                                                //UI字典\r\n        _richRankData : null,                                                                                          //财富排行榜的信息\r\n        _ui_baseUrl: null,                                                                                               //ui整理的字典\r\n        _roomComp: null,                                                                                                //房间脚本\r\n        _enterRoomCallFunc : null,                                                                                     //进入游戏房间后的回调\r\n        _isFirstEnter : null,                                                                                          //是否第一次进入游戏\r\n        _reConnectNum : null,                                                                                          //重连次数\r\n\r\n        comp_uiContainer : {\r\n            'default' : null,\r\n            type : require('Obj_uiContainer'),\r\n            displayName : 'UI容器'\r\n        },\r\n        comp_enterBtn : {\r\n            'default' : null,\r\n            type : require('Platform_ui_enter'),\r\n            displayName : '房间入口'\r\n        },\r\n        comp_leftRank : {\r\n            'default' : null,\r\n            type : require('Platform_leftRank'),\r\n            displayName : '左边列表容器'\r\n        },\r\n        comp_bottomBtns : {\r\n            'default' : null,\r\n            type : require('Platform_bottomBtns'),\r\n            displayName : '底部按钮容器'\r\n        },\r\n        comp_topInfo : {\r\n            'default' : null,\r\n            type : require('Platform_topInfo'),\r\n            displayName : '大厅顶部信息'\r\n        },\r\n    },\r\n\r\n    // use this for initialization\r\n    onLoad: function () {\r\n        this._super();\r\n        this._ui_baseUrl = 'UI_prefabs/';\r\n        GG.platformMgr = this;\r\n        this._roomNode = false;\r\n        this._isFirstEnter = false;\r\n        this._reConnectNum = 0;\r\n    },\r\n\r\n    start : function () {\r\n        this._initMainScene();\r\n\r\n        if(G_Config_common.isLocal){\r\n            var self = this;\r\n            var id = setInterval(function () {\r\n                if(GG.tipsMgr && !self.getAdIsLimit()) GG.tipsMgr.addNotice('这是一个很长的公告------------------');\r\n            }, 3000)\r\n        }\r\n    },\r\n\r\n    _initMainScene : function () {\r\n        if(G_Config_common.isLocal){\r\n            this.comp_leftRank.setRichData();\r\n            var self = this;\r\n            setTimeout(function () {\r\n                self.showHomeList(false, true);\r\n                // GG.audioMgr.playMusic();\r\n            }, 100)\r\n        }else{\r\n            var self = this;\r\n            this.comp_leftRank.setRichData();\r\n            //设置玩家信息\r\n            this.comp_topInfo.initShow();\r\n            //是否直接跳转到房间列表\r\n            setTimeout(function () {\r\n                var dataObj = GG.getPlayer().getOutHomeData()\r\n                if(dataObj && dataObj.gameType != G_TYPE.gameModule.platform) self.comp_enterBtn.showHomeListFirst(dataObj.gameType, true);\r\n                else self.showHomeList(false, true);\r\n            }, 100);\r\n        }\r\n    },\r\n\r\n    //显示某个UI，传入G_RES_URL里面的UI名字\r\n    openUI : function (uiName, callBack) {\r\n        this.comp_uiContainer.addUI(uiName, callBack);\r\n    },\r\n\r\n    //控制房间列表的显隐\r\n    showHomeList : function (isOut, isNoEffect) {\r\n        this.comp_enterBtn.moveOutScene(isOut, isNoEffect);\r\n        this.comp_leftRank.moveOutScene(isOut, isNoEffect);\r\n        this.comp_bottomBtns.moveOutScene(isOut, isNoEffect);\r\n        this.comp_topInfo.setHomeListShow(isOut, isNoEffect);\r\n        if(this._roomComp){\r\n            if(isOut) {\r\n                this._roomComp.showLayer();\r\n                GG.platformMgr.setAdLimit(true);\r\n            } else {\r\n                this._roomComp.hideLayer();\r\n                GG.platformMgr.setAdLimit(false);\r\n            }\r\n        }\r\n    },\r\n    //显示房间列表信息\r\n    setHomeListInfo : function (data) {\r\n        this._roomComp.setDataList(data);\r\n    },\r\n\r\n    //加载配置文件结束\r\n    _addConfigCallFunc : function () {\r\n        var table = GG.tableMgr.getTable(G_RES_URL.dict_tablesName.grabConfig);\r\n        if(table) {\r\n            var dataObj = table.getFirstData();\r\n            this._addConfig(G_Config_grab, dataObj);\r\n        }\r\n\r\n        var table = GG.tableMgr.getTable(G_RES_URL.dict_tablesName.commonConfig);\r\n        if(table) {\r\n            var dataObj = table.getFirstData();\r\n            this._addConfig(G_Config_common, dataObj);\r\n        }\r\n    },\r\n    //增加配置信息\r\n    _addConfig : function (targetObject, addObject) {\r\n        if(addObject){\r\n            for(var attrName in addObject){\r\n                targetObject[attrName] = addObject[attrName];\r\n            }\r\n        }\r\n    },\r\n\r\n    showRoomUI : function (prefabName, callBack) {\r\n        if (!this._roomComp) {\r\n            var self = this,\r\n                uiComp;\r\n            G_DATA.getRoomListJson(function () {\r\n                cc.loader.loadRes(self._ui_baseUrl + prefabName, function (err, prefab) {\r\n                    if(err){\r\n\r\n                    }else{\r\n                        var uiNode = cc.instantiate(prefab);\r\n                        uiNode.parent = self.comp_bottomBtns.node;\r\n                        uiComp = uiNode.getComponent(prefabName);\r\n                        self._roomComp = uiComp;\r\n                    }\r\n                    if(callBack){\r\n                        callBack(uiComp);\r\n                        callBack = null;\r\n                    }\r\n                });\r\n            })\r\n        } else {\r\n            if(callBack){\r\n                callBack(this._roomComp);\r\n                callBack = null;\r\n            }\r\n        }\r\n    },\r\n\r\n    //释放房间列表资源\r\n    releaseRoomUI : function () {\r\n        var deps = cc.loader.getDependsRecursively(this._ui_baseUrl + 'Prefab_roomList');\r\n        cc.loader.release(deps);\r\n    },\r\n\r\n    //进入游戏房间的请求\r\n    requestEnterRoom : function (netData, callFunc) {\r\n        this._enterRoomCallFunc = callFunc;\r\n        GG.socketMgr.SendMsg(NetType.s_enterHouse, netData);\r\n        GG.socketMgr.registerLong(NetType.r_enterHouseReturn, this.net_setHomeData.bind(this));\r\n    },\r\n\r\n    //接收到进房信息\r\n    net_setHomeData : function (recvData) {\r\n        if(!recvData) return;\r\n        var tip = recvData.tip;\r\n        if(tip.code != G_TYPE.serverCodeType.success) {\r\n            // console.log(tip.tip);\r\n            //进入房间失败-金币不足\r\n            if (tip.code == G_TYPE.serverCodeType.goldNotEnough) {\r\n                GG.tipsMgr.showConfirmTip_ONE(tip.tip, function () {\r\n                    //显示房间列表\r\n                    //是否直接跳转到房间列表\r\n                    // this._isFirstEnter = false;\r\n                    // this._oneRequestEnd();\r\n                }.bind(this));\r\n                return;\r\n            }else{\r\n                GG.tipsMgr.showConfirmTip_ONE(tip.tip, function () {\r\n                    //进入房间失败\r\n                    if(tip.code == G_TYPE.serverCodeType.matchNoEnd){\r\n                        //已经开始的比赛未结束\r\n\r\n                        //清理hash信息\r\n                        // G_DATA.setCurSceneHash('',0);\r\n                        // GG.exitHome();\r\n                    }\r\n                });\r\n            }\r\n            return;\r\n        }\r\n        var inHomeData = G_OBJ.data_inHomeData();\r\n        inHomeData.net_inHomeData = recvData;\r\n        GG.getPlayer().setInHomeData(inHomeData);\r\n        if(this._enterRoomCallFunc){\r\n            this._enterRoomCallFunc();\r\n            this._enterRoomCallFunc = null;\r\n        }\r\n    },\r\n\r\n    onDestroy : function () {\r\n        this._super();\r\n        GG.platformMgr = null;\r\n        // this.releaseRoomUI();\r\n    },\r\n\r\n    // called every frame, uncomment this function to activate update callback\r\n    // update: function (dt) {\r\n\r\n    // },\r\n});\r\n"]}