{"version":3,"sources":["assets\\Script\\Common\\Managers\\WebMobile_handler.js"],"names":["module","exports","cc","Class","properties","_isGameStart","_type_toolbar","_isVertical","ctor","document","_initMobileWeb","gameStart","_addHideListener","sys","isMobile","_addResizeListener","window","addEventListener","isLandscape","body","clientWidth","clientHeight","_lastHeight","innerHeight","_doSafariHandler","G_TYPE","webMobile_design","toolbar_hide","adaptSceneSize","bind","showStateName","showChange","hidden","mozHidden","msHidden","webkitHidden","self","Boolean","GG","_resumeWebGame","_pauseWebGame","userAgent","navigator","indexOf","toolbar_show","offH","_firstDesignSize","height","_changeDesign","width","_scrollGame","setTimeout","scrollTo","_designWidth","_designHeight","_initData","designSize","view","getDesignResolutionSize","innerWidth","setOrientation","macro","ORIENTATION_PORTRAIT","setDesignResolutionSize","ResolutionPolicy","SHOW_ALL","ORIENTATION_LANDSCAPE","EXACT_FIT","FIXED_HEIGHT","getLocalHost","location","host"],"mappings":"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","file":"unknown","sourcesContent":["module.exports = cc.Class({\r\n    properties: {\r\n        _isGameStart : null,\r\n        _type_toolbar : null,\r\n        _isVertical : null,\r\n    },\r\n\r\n    // use this for initialization\r\n    ctor: function () {\r\n        this._isGameStart = false;\r\n        this._isVertical = false;\r\n        if(document){\r\n            this._initMobileWeb();\r\n        }\r\n    },\r\n\r\n    gameStart : function () {\r\n        this._isGameStart = true;\r\n    },\r\n\r\n    _initMobileWeb : function () {\r\n        this._addHideListener();\r\n        if(cc.sys.isMobile) this._addResizeListener();\r\n    },\r\n\r\n    _addResizeListener : function () {\r\n        // cc.view.resizeWithBrowserSize(true);\r\n        // cc.view.adjustViewPort(true);\r\n        // cc.view.setOrientation(cc.macro.ORIENTATION_LANDSCAPE);\r\n        window.addEventListener(\"resize\", function(){\r\n            if(this._isGameStart){\r\n                var isLandscape = document.body.clientWidth > document.body.clientHeight;\r\n                if(isLandscape){\r\n                    this._isVertical = false;\r\n                    if(this._lastHeight != window.innerHeight){\r\n                        if(this._lastHeight && (this._lastHeight > window.innerHeight)){\r\n                            //show toolbar\r\n                            this._doSafariHandler();\r\n                            return;\r\n                        }\r\n                        this._lastHeight = window.innerHeight;\r\n                    }\r\n                }\r\n                this._isVertical = !isLandscape;\r\n                this._type_toolbar = G_TYPE.webMobile_design.toolbar_hide;\r\n                this.adaptSceneSize();\r\n            }\r\n        }.bind(this));\r\n    },\r\n\r\n    _addHideListener : function () {\r\n        var showStateName, showChange;\r\n        if (typeof document.hidden !== \"undefined\") {\r\n            showChange = \"visibilitychange\";\r\n            showStateName = \"visibilityState\";\r\n        } else if (typeof document.mozHidden !== \"undefined\") {\r\n            showChange = \"mozvisibilitychange\";\r\n            showStateName = \"mozVisibilityState\";\r\n        } else if (typeof document.msHidden !== \"undefined\") {\r\n            showChange = \"msvisibilitychange\";\r\n            showStateName = \"msVisibilityState\";\r\n        } else if (typeof document.webkitHidden !== \"undefined\") {\r\n            showChange = \"webkitvisibilitychange\";\r\n            showStateName = \"webkitVisibilityState\";\r\n        }\r\n        var self = this;\r\n        document.addEventListener(showChange, function() {\r\n            if(self._isGameStart){\r\n                //var isShow = Boolean(document[showStateName]==\"visible\");\r\n                if(Boolean(document[showStateName]==\"visible\")){\r\n                    //回到游戏\r\n                    GG._resumeWebGame();\r\n                }else{\r\n                    //暂停游戏\r\n                    GG._pauseWebGame();\r\n                }\r\n            }\r\n        }, false);\r\n    },\r\n\r\n    _doSafariHandler : function () {\r\n        var userAgent = navigator.userAgent;\r\n        if(userAgent.indexOf('Safari') > -1){\r\n            this._type_toolbar = G_TYPE.webMobile_design.toolbar_show;\r\n            var offH = this._firstDesignSize.height * 0.13;\r\n            this._changeDesign(this._firstDesignSize.width, this._firstDesignSize.height+offH);\r\n            this.adaptSceneSize();\r\n        }\r\n    },\r\n\r\n    _scrollGame : function (offH) {\r\n        setTimeout(function(){\r\n            window.scrollTo(0,offH*0.22);\r\n        }, 100)\r\n    },\r\n\r\n    _changeDesign : function (width, height) {\r\n        this._designWidth = width;\r\n        this._designHeight = height;\r\n    },\r\n\r\n    _initData : function () {\r\n        if(this._firstDesignSize) return;\r\n        var designSize = cc.view.getDesignResolutionSize();\r\n        if(designSize.width > designSize.height){\r\n            this._firstDesignSize = {width:designSize.width, height:designSize.height};\r\n        }else {\r\n            this._firstDesignSize = {width:designSize.height, height:designSize.width};\r\n        }\r\n        this._lastHeight = window.innerHeight < window.innerWidth ? window.innerHeight : window.innerWidth;\r\n\r\n        this._changeDesign(this._firstDesignSize.width, this._firstDesignSize.height);\r\n        this._type_toolbar = G_TYPE.webMobile_design.toolbar_hide;\r\n    },\r\n    adaptSceneSize : function () {\r\n        this._initData();\r\n\r\n        if(cc.sys.isMobile) {\r\n            if(document){\r\n                if(this._isVertical){\r\n                    cc.view.setOrientation(cc.macro.ORIENTATION_PORTRAIT);\r\n                    cc.view.setDesignResolutionSize(this._firstDesignSize.width, this._firstDesignSize.height, cc.ResolutionPolicy.SHOW_ALL);\r\n                }else{\r\n                    cc.view.setOrientation(cc.macro.ORIENTATION_LANDSCAPE);\r\n                    switch (this._type_toolbar){\r\n                        case G_TYPE.webMobile_design.toolbar_hide:\r\n                            cc.view.setDesignResolutionSize(this._firstDesignSize.width, this._firstDesignSize.height, cc.ResolutionPolicy.EXACT_FIT);\r\n                            break\r\n                        case G_TYPE.webMobile_design.toolbar_show:\r\n                            setTimeout(function () {\r\n                                cc.view.setDesignResolutionSize(this._designWidth, this._designHeight, cc.ResolutionPolicy.FIXED_HEIGHT);\r\n                                this._scrollGame(this._designHeight - this._firstDesignSize.height);\r\n                            }.bind(this), 200)\r\n                            break\r\n                        default:\r\n                            cc.view.setDesignResolutionSize(this._firstDesignSize.width, this._firstDesignSize.height, cc.ResolutionPolicy.EXACT_FIT);\r\n                            break\r\n                    }\r\n                }\r\n            }else{\r\n                cc.view.setDesignResolutionSize(this._firstDesignSize.width, this._firstDesignSize.height, cc.ResolutionPolicy.EXACT_FIT);\r\n            }\r\n        }else {\r\n            cc.view.setDesignResolutionSize(this._firstDesignSize.width, this._firstDesignSize.height, cc.ResolutionPolicy.SHOW_ALL);\r\n        }\r\n    },\r\n\r\n    getLocalHost : function () {\r\n        return window.location.host\r\n    },\r\n\r\n    // called every frame, uncomment this function to activate update callback\r\n    // update: function (dt) {\r\n\r\n    // },\r\n});\r\n"]}