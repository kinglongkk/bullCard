{"version":3,"sources":["assets\\Script\\Views\\UIComponents\\Prefab_dialog_dealerList.js"],"names":["cc","Class","extends","require","properties","_minDealerGold","node_bottomBtns","default","type","Node","displayName","node_goldTip","comp_goldSlider","onLoad","_super","_dealerItemCompName","_moneyFormat","_limitText","G_CHINESE","dealerGoldText1","dealerGoldText2","dealerGoldText3","dealerGoldText4","_changeInterval","G_Config_bull100","dealerSliderInterval","_registerEvent","_initDealerList","start","setData","dataObj","GG","bull100Mgr","getMinDealerGold","myGold","dealerInfo","myselfID","getPlayerID","isInDealerList","rankList","dataList","playerData","isDealer","myRankNum","i","length","playerId","splice","headImg","icon","name","nickname","gold","usableBalance","push","setBtnShow","_setDealerList","offGold","_showDownTip","G_TOOL","formatStr","setBtnEnable","children","btns","tag","registerButton","_onClick_dealerBtnsr","hideLayer","event","currentTarget","commitContinueDealer","getMoveNum","send_upDealer","send_downDealer","itemPrefab","prefab_item","comp_itemContainer","item","comp","getItemByIndex","getComponent","clearItems","setGoldLimitTip","minDealerGold","str","Label","string","isMyDealer","active","upDealerSuccess","showLayer","tipStr","tipObj","tipIndex","showStr","isCountDown","showPos","G_DATA","getCenterTipPos","downDealerSuccess","leftStr","changeMoney","RichText"],"mappings":"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","file":"unknown","sourcesContent":["//上庄列表的界面\r\n\r\n\r\ncc.Class({\r\n    extends: require('BaseDialog'),\r\n\r\n    properties: {\r\n        _minDealerGold : null,                                                                                            //最小上庄金额\r\n\r\n        node_bottomBtns : {\r\n            default : null,\r\n            type : cc.Node,\r\n            displayName : '按钮容器'\r\n        },\r\n        node_goldTip : {\r\n            default : null,\r\n            type : cc.Node,\r\n            displayName : '金币限制提示'\r\n        },\r\n        comp_goldSlider : {\r\n            default : null,\r\n            type : require('Obj_dealerListSlider'),\r\n            displayName : '进度条'\r\n        },\r\n    },\r\n\r\n    // use this for initialization\r\n    onLoad: function () {\r\n        this._super('UI_dealerList');\r\n        this._dealerItemCompName = 'Obj_dealerListCell';\r\n        this._moneyFormat = '<color=#FFFD61>%s</c>';\r\n        this._limitText = [G_CHINESE.dealerGoldText1, G_CHINESE.dealerGoldText2, G_CHINESE.dealerGoldText3, G_CHINESE.dealerGoldText4];\r\n        this._changeInterval = G_Config_bull100.dealerSliderInterval;\r\n\r\n        this._registerEvent();\r\n        this._initDealerList();\r\n    },\r\n\r\n    start : function () {\r\n\r\n    },\r\n\r\n    setData : function (dataObj) {\r\n        this._minDealerGold = GG.bull100Mgr.getMinDealerGold();\r\n        var myGold = dataObj.myGold;\r\n        var dealerInfo = dataObj.dealerInfo;\r\n        //var myMaxDealerGold = dealerInfo.maxDealerCoin;\r\n        var myselfID = GG.getPlayerID();\r\n        var isInDealerList = false;                             //玩家自己在上庄列表\r\n        var rankList = dataObj.rankList;\r\n        if(!rankList) rankList = [];\r\n        var dataList = [], playerData, isDealer, myRankNum='';\r\n        for(var i = 0; i < rankList.length; i ++){\r\n            playerData = rankList[i];\r\n            isDealer = false;\r\n\r\n            if(playerData.playerId == dealerInfo.playerId) {\r\n                dealerInfo = null;\r\n                isDealer = true;\r\n                dataList.splice(0,0,{\r\n                    headImg : playerData.icon,\r\n                    name : playerData.nickname,\r\n                    gold : playerData.usableBalance,\r\n                    isDealer : isDealer\r\n                });\r\n            }else{\r\n                dataList.push({\r\n                    headImg : playerData.icon,\r\n                    name : playerData.nickname,\r\n                    gold : playerData.usableBalance,\r\n                    isDealer : isDealer\r\n                })\r\n            }\r\n            if(playerData.playerId == myselfID) {\r\n                isInDealerList = true;\r\n                myRankNum = i+1;\r\n            }\r\n        }\r\n        if(dealerInfo){\r\n            dataList.splice(0,0,{\r\n                headImg : dealerInfo.icon,\r\n                name : dealerInfo.nickname,\r\n                gold : dealerInfo.usableBalance,\r\n                isDealer : true\r\n            });\r\n            if(dealerInfo.playerId == myselfID) {\r\n                isDealer = true;\r\n                isInDealerList = true;\r\n            }\r\n        }\r\n\r\n        this.setBtnShow(isInDealerList, isDealer);\r\n        this._setDealerList(dataList);\r\n\r\n        var offGold = this._changeInterval;\r\n        if (isInDealerList) {\r\n            //在上庄列表\r\n            this.comp_goldSlider.setData(myGold, offGold, offGold);\r\n            if(isDealer){\r\n                this._showDownTip(this._limitText[2]);\r\n            }else{\r\n                //在排队中\r\n                this._showDownTip(G_TOOL.formatStr(this._limitText[3], myRankNum));\r\n            }\r\n        } else {\r\n            //不在上庄列表\r\n            this.comp_goldSlider.setData(myGold, offGold, this._minDealerGold);\r\n\r\n            if(myGold < this._minDealerGold){\r\n                //金币不足，无法上庄\r\n                this._showDownTip(this._limitText[1], this._minDealerGold);\r\n                this.setBtnEnable(this.node_bottomBtns.children[1], false);\r\n\r\n            }else{\r\n                //金币足够\r\n                this._showDownTip(this._limitText[0], this._minDealerGold);\r\n                this.setBtnEnable(this.node_bottomBtns.children[1], true);\r\n            }\r\n        }\r\n    },\r\n\r\n    _registerEvent : function () {\r\n        var btns = this.node_bottomBtns.children;\r\n        for(var i = 0; i < btns.length; i ++){\r\n            btns[i].tag = i;\r\n            this.registerButton(btns[i], this._onClick_dealerBtnsr, this);\r\n        }\r\n    },\r\n    hideLayer : function (event) {\r\n        this._super();\r\n    },\r\n    _onClick_dealerBtnsr : function (event) {\r\n        switch (event.currentTarget.tag){\r\n            case 0:\r\n                //续庄\r\n                GG.bull100Mgr.commitContinueDealer(this.comp_goldSlider.getMoveNum());\r\n                break\r\n            case 1:\r\n                //上庄\r\n                GG.bull100Mgr.send_upDealer(this.comp_goldSlider.getMoveNum());\r\n                break\r\n            case 2:\r\n                //下庄\r\n                GG.bull100Mgr.send_downDealer();\r\n                break\r\n            default:\r\n                break\r\n        }\r\n        //cc.eventManager.pauseTarget(this.comp_goldSlider.node, true);\r\n    },\r\n\r\n\r\n    //初始化庄家列表\r\n    _initDealerList : function () {\r\n        var dataObj = {\r\n            itemPrefab : this.prefab_item,\r\n        }\r\n        this.comp_itemContainer.setData(dataObj);\r\n    },\r\n    //设置列表内容\r\n    _setDealerList : function (dataList) {\r\n        var item, comp, i = 0;\r\n        for(i = 0; i < dataList.length; i ++){\r\n            item = this.comp_itemContainer.getItemByIndex(i);\r\n            if(item){\r\n                comp = item.getComponent(this._dealerItemCompName);\r\n                comp.setData(dataList[i]);\r\n            }\r\n        }\r\n        this.comp_itemContainer.clearItems(i - 1);\r\n    },\r\n\r\n    //===================================\r\n\r\n    //设置上庄金额限制提示\r\n    setGoldLimitTip : function (myGold, minDealerGold) {\r\n        var str;\r\n        if(myGold > minDealerGold) {\r\n            str = this._limitText[0];\r\n        } else {\r\n            str = this._limitText[1];\r\n        }\r\n        this.node_goldTip.getComponent(cc.Label).string = str;\r\n    },\r\n\r\n    //根据是否已经在庄家列表来判定按钮的显隐\r\n    setBtnShow : function (isMyDealer, isDealer) {\r\n        var btns = this.node_bottomBtns.children;\r\n        btns[0].active = isMyDealer || isDealer;//我要续庄\r\n        btns[1].active = !(isMyDealer || isDealer);//我要上庄\r\n        btns[2].active = isMyDealer || isDealer;//我要下庄\r\n    },\r\n\r\n    //上庄成功\r\n    upDealerSuccess : function (dataObj) {\r\n        this.showLayer();\r\n        this.setData(dataObj);\r\n        if(dataObj.tipStr){\r\n            var tipObj = {\r\n                tipIndex : 19,\r\n                showStr : dataObj.tipStr,\r\n                isCountDown : false,\r\n                showPos : G_DATA.getCenterTipPos(),\r\n                //callBack : this.on_beforeStart.bind(this)\r\n            }\r\n            // GG.tipsMgr.showTxtTip(tipObj);\r\n        }\r\n    },\r\n\r\n    //从上庄列表下来\r\n    downDealerSuccess : function (dataObj) {\r\n        this.showLayer();\r\n        this.setData(dataObj);\r\n        if(dataObj.tipStr){\r\n            var tipObj = {\r\n                tipIndex : 19,\r\n                showStr : dataObj.tipStr,\r\n                isCountDown :false,\r\n                showPos : G_DATA.getCenterTipPos(),\r\n            }\r\n            // GG.tipsMgr.showTxtTip(tipObj);\r\n        }\r\n    },\r\n\r\n    //==============================\r\n\r\n    //设置底部的tip限制提示\r\n    _showDownTip : function (leftStr, gold) {\r\n        if(gold) gold = G_TOOL.formatStr(this._moneyFormat, G_TOOL.changeMoney(gold));\r\n        else gold = '';\r\n        this.node_goldTip.getComponent(cc.RichText).string = leftStr + gold;\r\n    },\r\n\r\n    // called every frame, uncomment this function to activate update callback\r\n    // update: function (dt) {\r\n\r\n    // },\r\n});\r\n"]}