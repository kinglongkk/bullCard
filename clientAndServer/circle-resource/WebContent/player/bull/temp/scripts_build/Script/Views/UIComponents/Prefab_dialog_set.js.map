{"version":3,"sources":["assets\\Script\\Views\\UIComponents\\Prefab_dialog_set.js"],"names":["setType","typeMusic","typeSound","cc","Class","extends","require","properties","_musicIsOpen","_soundIsOpen","_isOpenFirst","_dict_lastSet","node_changeBtn","default","type","Node","displayName","node_musicSwitch","node_soundSwitch","node_musicIcon","node_soundIcon","label_name","Label","onLoad","_super","_registerEvent","registerButton","_onClick_change","onClick_open","hideLayer","_onClick_close","G_Config_common","isLocal","musiceStr","soundStr","sendStr","self","GG","httpMgr","sendHttpRequest","G_DIALOG_URL","saveSystemSetUrl","data","bind","setData","audioMgr","getAudioConfig","setAudioConfig","defaultSetSound","music","sound","_setName","showLayer","attr","event","_setMusicOpen","saveMusicConfig","_setSoundOpen","saveSoundConfig","pointImg","openImg","lightIcon","children","active","x","width","isOpenMusic","isOpenSound","name","getPlayer","getPlayerName","G_TOOL","getNameLimit","string","tipsMgr","showConfirmTip_TWO","G_CHINESE","exitText2","exitGame"],"mappings":"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","file":"unknown","sourcesContent":["//玩家系统设置\r\nvar setType = {\r\n    typeMusic : 1,\r\n    typeSound : 2,\r\n}\r\n\r\ncc.Class({\r\n    extends: require('BaseDialog'),\r\n\r\n    properties: {\r\n        _musicIsOpen : null,                                                                                                 //音乐是否开启\r\n        _soundIsOpen : null,                                                                                                 //音效是否开启\r\n        _isOpenFirst : null,                                                                                                 //是否第一次打开\r\n        _dict_lastSet : null,                                                                                                //上次的设定，判定是否有改变配置\r\n\r\n        node_changeBtn : {\r\n            default : null,\r\n            type : cc.Node,\r\n            displayName : '切换账号'\r\n        },\r\n        node_musicSwitch : {\r\n            default : null,\r\n            type : cc.Node,\r\n            displayName : '音乐开关'\r\n        },\r\n        node_soundSwitch : {\r\n            default : null,\r\n            type : cc.Node,\r\n            displayName : '音效开关'\r\n        },\r\n        node_musicIcon: {\r\n            default : null,\r\n            type : cc.Node,\r\n            displayName : '音乐左边图标'\r\n        },\r\n        node_soundIcon: {\r\n            default : null,\r\n            type : cc.Node,\r\n            displayName : '音效左边图标'\r\n        },\r\n        label_name : {\r\n            default : null,\r\n            type : cc.Label,\r\n            displayName : '玩家名字'\r\n        },\r\n    },\r\n\r\n    // use this for initialization\r\n    onLoad: function () {\r\n        this._super();\r\n        this._registerEvent();\r\n        this._isOpenFirst = true;\r\n    },\r\n    _registerEvent : function () {\r\n        this.registerButton(this.node_changeBtn, this._onClick_change, this);\r\n        this.registerButton(this.node_musicSwitch, this.onClick_open, this, setType.typeMusic, true);\r\n        this.registerButton(this.node_soundSwitch, this.onClick_open, this, setType.typeSound, true);\r\n    },\r\n    hideLayer : function(){\r\n        this._super();\r\n        this._dict_lastSet = null;\r\n    },\r\n\r\n    _onClick_close : function () {\r\n        if(G_Config_common.isLocal) {\r\n            this.hideLayer();\r\n            return\r\n        }\r\n\r\n        if(this._dict_lastSet){\r\n            if(this._dict_lastSet['music']!=this._musicIsOpen||this._dict_lastSet['sound']!=this._soundIsOpen) {\r\n                //配置发生改变,保存设置\r\n                var musiceStr = this._musicIsOpen ? 'Set_open' : 'Set_close';\r\n                var soundStr = this._soundIsOpen ? 'Set_open' : 'Set_close';\r\n                var sendStr = \"musicClass=\"+musiceStr+'&soundClass='+soundStr+'&gameType=DOU_NIU';\r\n                var self = this;\r\n                GG.httpMgr.sendHttpRequest(G_DIALOG_URL.saveSystemSetUrl, sendStr, function (data) {\r\n                    self.hideLayer();\r\n                }.bind(this));\r\n            }else this.hideLayer();\r\n        }else this.hideLayer();\r\n    },\r\n\r\n    setData : function () {\r\n        var self = this;\r\n        if(G_Config_common.isLocal){\r\n            var data = {'music':true,'sound':true};\r\n            this._dict_lastSet = data;\r\n            if(GG.audioMgr.getAudioConfig()) data = GG.audioMgr.getAudioConfig();\r\n            else GG.audioMgr.setAudioConfig({'music':true,'sound':true});\r\n            this.defaultSetSound(data.music, data.sound);\r\n            this._setName();\r\n            self.showLayer();\r\n        }else{\r\n            //获取玩家系统设置\r\n            //if(this._isOpenFirst){\r\n            //    GG.httpMgr.sendHttpLogin(G_DIALOG_URL.getSystemSetUrl, 'gameType=DOU_NIU', function (data) {\r\n            //        var config;\r\n            //        if(data.code == 0){\r\n            //            config = {'music':true,'sound':true};\r\n            //        } else {\r\n            //            config = data.data.result[0];\r\n            //        }\r\n            //        //如果音乐已经播放，则不需要重复播放\r\n            //        if(config.music && GG.audioMgr.getIsPlayMusic()) GG.audioMgr.saveSoundConfig(config.sound);\r\n            //        else GG.audioMgr.setAudioConfig(config);\r\n            //\r\n            //        var data = GG.audioMgr.getAudioConfig();\r\n            //        self.defaultSetSound(data.music, data.sound);\r\n            //        self._setName();\r\n            //        self._isOpenFirst = false;\r\n            //        self.showLayer();\r\n            //    }.bind(this));\r\n            //}else {\r\n            //    var data = GG.audioMgr.getAudioConfig();\r\n            //    this.defaultSetSound(data.music, data.sound);\r\n            //    this._setName();\r\n            //    self.showLayer();\r\n            //}\r\n            var data = GG.audioMgr.getAudioConfig();\r\n            if(data){\r\n                this._dict_lastSet = {};\r\n                for(var attr in data){\r\n                    this._dict_lastSet[attr] = data[attr];\r\n                }\r\n                this.defaultSetSound(data.music, data.sound);\r\n                this._setName();\r\n                self.showLayer();\r\n            }\r\n        }\r\n    },\r\n\r\n    //玩家点击了开关\r\n    onClick_open : function (event, type) {\r\n        switch (type) {\r\n            case setType.typeMusic :\r\n                //音乐\r\n                this._setMusicOpen();\r\n                GG.audioMgr.saveMusicConfig(this._musicIsOpen);\r\n                break;\r\n            case setType.typeSound :\r\n                //音效\r\n                this._setSoundOpen();\r\n                GG.audioMgr.saveSoundConfig(this._soundIsOpen);\r\n                break;\r\n        }\r\n    },\r\n    //设置音乐开关\r\n    _setMusicOpen : function () {\r\n        this._musicIsOpen = !this._musicIsOpen;\r\n        //表现\r\n        var pointImg, openImg, lightIcon;\r\n        openImg = this.node_musicSwitch.children[0];\r\n        pointImg = this.node_musicSwitch.children[1];\r\n        lightIcon = this.node_musicIcon.children[0];\r\n\r\n        openImg.active = this._musicIsOpen;\r\n        if(this._musicIsOpen){\r\n            pointImg.x = this.node_musicSwitch.width/2 - pointImg.width/2;\r\n        }else{\r\n            pointImg.x = -this.node_musicSwitch.width/2 + pointImg.width/2;\r\n        }\r\n        lightIcon.active = this._musicIsOpen;\r\n    },\r\n    //设置音效开关\r\n    _setSoundOpen : function () {\r\n        this._soundIsOpen = !this._soundIsOpen;\r\n        //表现\r\n        var pointImg, openImg, lightIcon;\r\n        openImg = this.node_soundSwitch.children[0];\r\n        pointImg = this.node_soundSwitch.children[1];\r\n        lightIcon = this.node_soundIcon.children[0];\r\n\r\n        openImg.active = this._soundIsOpen;\r\n        if(this._soundIsOpen){\r\n            pointImg.x = this.node_soundSwitch.width/2 - pointImg.width/2;\r\n        }else{\r\n            pointImg.x = -this.node_soundSwitch.width/2 + pointImg.width/2;\r\n        }\r\n        lightIcon.active = this._soundIsOpen;\r\n    },\r\n    \r\n    //玩家默认系统设置(第一次进入游戏设置), isOpenMusic=true则开启音乐，音效等同\r\n    defaultSetSound : function (isOpenMusic, isOpenSound) {\r\n        this._musicIsOpen = !isOpenMusic;\r\n        this._soundIsOpen = !isOpenSound;\r\n        this._setMusicOpen();\r\n        this._setSoundOpen();\r\n    },\r\n\r\n    //设置名字\r\n    _setName : function (name) {\r\n        if(G_Config_common.isLocal)  name = '123456';\r\n        else name = GG.getPlayer().getPlayerName();\r\n        if(!name) name = ''\r\n        else name = G_TOOL.getNameLimit(name, 16);\r\n        this.label_name.string = name;\r\n    },\r\n\r\n    _onClick_change : function (event) {\r\n        GG.tipsMgr.showConfirmTip_TWO(G_CHINESE.exitText2, function () {\r\n            //确认退出\r\n            GG.exitGame();\r\n        });\r\n\r\n        //var sendData = \"gameId=1&dateClass=0&pageSize=20&pageNow=0\";\r\n        //GG.httpMgr.sendHttpLogin(\"game/statistics/user/records.html\", sendData, function (data) {\r\n        //    console.log('get login======');\r\n        //    console.log(data);\r\n        //}.bind(this));\r\n    }\r\n    // called every frame, uncomment this function to activate update callback\r\n    // update: function (dt) {\r\n\r\n    // },\r\n});\r\n"]}