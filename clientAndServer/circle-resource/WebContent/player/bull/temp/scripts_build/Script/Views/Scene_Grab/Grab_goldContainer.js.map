{"version":3,"sources":["assets\\Script\\Views\\Scene_Grab\\Grab_goldContainer.js"],"names":["cc","Class","extends","Component","properties","_pool","_callFunc","frame_gold","SpriteFrame","onLoad","_goldScale","G_Config_common","scale_moveGold","_addGoldTime","G_Config_grab","time_goldFly_Add","_resultGoldTime","time_goldFly_Result","NodePool","moveAddGolds","goldInfo","callFunc","GG","audioMgr","playSound","gold","act1","act2","delayTime","delayValue","time_goldFly_delay","i","goldNum","_getGold","position","startPos","_flyCallFunc","moveTo","targetPos","runAction","sequence","_flyAddGoldEnd","_endCallFunc","target","_removeGold","flyResultGold","dataList","dataObj","length","_setResultGolds","table","grabMgr","getTable","tableIndex","removeOneGoldImg","self","callBack","_resultGoldNum","recordLeaveGolds","goldNode","get","Node","sp","addComponent","Sprite","spriteFrame","parent","node","scale","active","goldeNode","put","clearAll","stopAllActions","goldList","children","num"],"mappings":"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","file":"unknown","sourcesContent":["//金币流动效果的处理层\r\n\r\n//var goldInfo = {\r\n//    startPos : cc.p(),\r\n//    targetPos : cc.p(),\r\n//    goldNum : 4,\r\n//    userData : '',\r\n//    tableIndex : 1,\r\n//    callFunc : '',\r\n//}\r\n\r\ncc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        _pool : null,\r\n        _callFunc : null,\r\n\r\n        frame_gold : cc.SpriteFrame,\r\n    },\r\n\r\n    // use this for initialization\r\n    onLoad: function () {\r\n        this._goldScale = G_Config_common.scale_moveGold;\r\n        this._addGoldTime = G_Config_grab.time_goldFly_Add;\r\n        this._resultGoldTime = G_Config_grab.time_goldFly_Result;\r\n\r\n        this._pool = new cc.NodePool('Grab_goldContainer');\r\n    },\r\n\r\n    moveAddGolds : function (goldInfo, callFunc) {\r\n        //this._callFunc = callFunc;\r\n        GG.audioMgr.playSound(15);\r\n        var gold,act1, act2, delayTime=0, delayValue = G_Config_grab.time_goldFly_delay;\r\n        for(var i = 0; i < goldInfo.goldNum; i ++){\r\n            gold = this._getGold();\r\n            gold.position = goldInfo.startPos;\r\n            gold._flyCallFunc = goldInfo.callFunc;\r\n\r\n            act1 = cc.delayTime(delayTime);\r\n            act2 = cc.moveTo(this._addGoldTime, goldInfo.targetPos);\r\n            gold.runAction(cc.sequence(act1, act2, cc.callFunc(this._flyAddGoldEnd, this, goldInfo)));\r\n            delayTime += delayValue;\r\n        }\r\n        if(gold) gold._endCallFunc = callFunc;\r\n    },\r\n    _flyAddGoldEnd : function (target, goldInfo) {\r\n        var gold = target;\r\n        if(gold._flyCallFunc) {\r\n            gold._flyCallFunc();\r\n            gold._flyCallFunc = null;\r\n        }\r\n        if(gold._endCallFunc) {\r\n            gold._endCallFunc();\r\n            gold._endCallFunc = null;\r\n        }\r\n        this._removeGold(gold);\r\n    },\r\n\r\n    //========================重构金币的回收显示\r\n\r\n    flyResultGold : function (dataList, callFunc) {\r\n        if(!dataList) return;\r\n        var dataObj;\r\n        this._callFunc = callFunc;\r\n        for(var i = 0; i < dataList.length; i ++){\r\n            dataObj = dataList[i];\r\n            if(dataObj){\r\n                this._setResultGolds(dataObj);\r\n            }\r\n        }\r\n    },\r\n    _setResultGolds : function (dataObj) {\r\n        for(var i = 0; i < dataObj.goldNum; i ++){\r\n            var gold = this._getGold();\r\n            var table = GG.grabMgr.getTable(dataObj.tableIndex);\r\n            var startPos = table.removeOneGoldImg();\r\n            if(!startPos) continue;\r\n            gold.position = startPos;\r\n\r\n            var act1 = cc.moveTo(this._resultGoldTime, dataObj.targetPos);\r\n            var self = this;\r\n            gold.runAction(cc.sequence(act1, cc.callFunc(function (target) {\r\n                self._removeGold(target);\r\n                if(self.callBack){\r\n                    self.callBack();\r\n                    self.callBack = null;\r\n                }\r\n            }, this, this._resultGoldNum)));\r\n        }\r\n    },\r\n\r\n    //剩余的金币全部移动到系统庄\r\n    recordLeaveGolds : function (targetPos) {\r\n\r\n    },\r\n\r\n    //addResultGolds : function (dataList, callFunc) {\r\n    //    if(dataList.length < 1) return;\r\n    //    this._callFunc = callFunc;\r\n    //    this._list_resultGold = dataList;\r\n    //    this._resultGoldNum = 0;\r\n    //\r\n    //    this._update_resultGold();\r\n    //    this.schedule(this._update_resultGold, G_Config_grab.time_goldFly_delay);\r\n    //    GG.audioMgr.playSound(18);\r\n    //},\r\n    //_update_resultGold : function () {\r\n    //    if(this._list_resultGold.length > 0){\r\n    //        var dataObj,gold,table,act1;\r\n    //        for(var i = this._list_resultGold.length-1; i >= 0; i --){\r\n    //            dataObj = this._list_resultGold[i];\r\n    //            if(dataObj.goldNum > 0){\r\n    //                gold = this._getGold();\r\n    //                this._resultGoldNum += 1;\r\n    //\r\n    //                table = GG.grabMgr.getTable(dataObj.tableIndex);\r\n    //                table.removeOneGoldImg();\r\n    //                gold.position = table.getWorldPos();\r\n    //\r\n    //                act1 = cc.moveTo(this._resultGoldTime, dataObj.targetPos);\r\n    //                gold.runAction(cc.sequence(act1, cc.callFunc(this._flyResultGoldEnd, this, this._resultGoldNum)));\r\n    //                dataObj.goldNum -= 1;\r\n    //            }else {\r\n    //                if(dataObj.callFunc) dataObj.callFunc(dataObj.tableIndex);\r\n    //                this._list_resultGold.splice(i, 1);\r\n    //                if(this._list_resultGold.length <= 0){\r\n    //                    this.unschedule(this._update_resultGold);\r\n    //                    this._list_resultGold = null;\r\n    //                }\r\n    //            }\r\n    //        }\r\n    //    }\r\n    //},\r\n    //_flyResultGoldEnd : function (target, userData) {\r\n    //    this._removeGold(target);\r\n    //    if(!this._list_resultGold && userData == this._resultGoldNum){\r\n    //        this._resultGoldNum = 0;\r\n    //        if(this._callFunc){\r\n    //            this._callFunc();\r\n    //            this._callFunc = null;\r\n    //        }\r\n    //    }\r\n    //},\r\n\r\n    _getGold : function () {\r\n        var goldNode = this._pool.get();\r\n        if(!goldNode){\r\n            goldNode = new cc.Node();\r\n            var sp = goldNode.addComponent(cc.Sprite);\r\n            sp.spriteFrame = this.frame_gold;\r\n        }\r\n        goldNode.parent = this.node;\r\n        goldNode.scale = this._goldScale;\r\n        goldNode.active = true;\r\n        return goldNode;\r\n    },\r\n\r\n    _removeGold : function (goldeNode) {\r\n        goldeNode.active = false;\r\n        this._pool.put(goldeNode);\r\n    },\r\n\r\n    clearAll : function () {\r\n        this.node.stopAllActions();\r\n        var goldList = this.node.children;\r\n        var num = goldList.length;\r\n        for(var i = num-1; i >= 0; i --){\r\n            this._removeGold(goldList[i]);\r\n        }\r\n    },\r\n\r\n    // called every frame, uncomment this function to activate update callback\r\n    // update: function (dt) {\r\n\r\n    // },\r\n});\r\n"]}