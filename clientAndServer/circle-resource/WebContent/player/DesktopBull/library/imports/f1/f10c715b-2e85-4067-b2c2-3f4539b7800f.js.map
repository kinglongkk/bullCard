{"version":3,"sources":["assets\\Script\\Views\\Scene_Platform\\UI\\Platform_ui_enter.js"],"names":["cc","Class","extends","require","properties","_roomPrefabName","_isTouchLimit","node_bull100","default","type","Node","displayName","node_grab","onLoad","_registerButton","_btn_clickEnter","G_TYPE","gameModule","bull100","grab","target","enterType","showHomeList","isNoEffect","self","GG","topTouchLayer","showNetRequest","platformMgr","showRoomUI","roomComp","G_Config_common","isLocal","closeNetRequest","netData","_getLocalData","setHomeListInfo","_sendRoomListRequest","gameModel","net_gameModule2","classic","httpMgr","sendHttpRequest","G_DIALOG_URL","gameRoomListUrl","data","bind","interval","i","roomInfo","id","minLimitPlayerBlance","currentPlayerCount","rowNum","Math","ceil","push","showHomeListFirst","node","callBack","userData","isNoScale","_isTouchEnabledEx","on","EventType","TOUCH_START","event","aniNode","children","_setAniPause","scale","audioMgr","playSound","TOUCH_END","call","TOUCH_CANCEL","isPause","comp","getComponent","dragonBones","ArmatureDisplay","_lastTimeScale","timeScale","_resumeAni","moveOutScene","isOut","_firstPosX","x","designSize","sys","isMobile","view","getDesignResolutionSize","visibleRect","width","setFrameHide","active","time","stopAllActions","targetPos","p","y","runAction","sequence","moveTo","callFunc"],"mappings":"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","file":"unknown","sourcesContent":["//显示所有入口动画的UI\r\n\r\ncc.Class({\r\n    extends: require('BaseUI'),\r\n    properties: {\r\n        _roomPrefabName: null,                                                                                          //房间节点名称\r\n        _isTouchLimit : null,                                                                                          //是否有点击限制\r\n\r\n        node_bull100 : {\r\n            default : null,\r\n            type : cc.Node,\r\n            displayName : '百人大战'\r\n        },\r\n        node_grab : {\r\n            default : null,\r\n            type : cc.Node,\r\n            displayName : '押宝大战'\r\n        },\r\n    },\r\n\r\n    // use this for initialization\r\n    onLoad: function () {\r\n        this._registerButton(this.node_bull100, this._btn_clickEnter, this, G_TYPE.gameModule.bull100);\r\n        this._registerButton(this.node_grab, this._btn_clickEnter, this, G_TYPE.gameModule.grab);\r\n        this._roomPrefabName = 'Prefab_roomList';\r\n    },\r\n\r\n    _btn_clickEnter : function (target, enterType) {\r\n        if(this._isTouchLimit) return;\r\n        this.showHomeList(enterType);\r\n    },\r\n    // _showTip : function (content) {\r\n    //     if(!this._tip){\r\n    //         var cNode = new cc.Node();\r\n    //         this._tip = cNode.addComponent(cc.Label);\r\n    //         cNode.parent = this.node;\r\n    //         cNode.color = cc.Color.RED;\r\n    //     }\r\n    //     this._tip.string = content;\r\n    // },\r\n\r\n    showHomeList : function (enterType, isNoEffect) {\r\n        var self = this;\r\n        GG.topTouchLayer.showNetRequest();\r\n        GG.platformMgr.showRoomUI(self._roomPrefabName, function (roomComp) {\r\n            if (roomComp) {\r\n                if(G_Config_common.isLocal){\r\n                    GG.topTouchLayer.closeNetRequest();\r\n                    var netData = self._getLocalData(enterType);\r\n                    netData.enterType = enterType;\r\n                    GG.platformMgr.showHomeList(true, isNoEffect);\r\n                    GG.platformMgr.setHomeListInfo(netData);\r\n                }else{\r\n                    self._sendRoomListRequest(enterType, isNoEffect);\r\n                }\r\n            }\r\n        });\r\n    },\r\n\r\n    //请求房间列表参数\r\n    _sendRoomListRequest : function (enterType, isNoEffect) {\r\n        var gameModel;\r\n        switch (enterType) {\r\n            case G_TYPE.gameModule.bull100:\r\n                gameModel = G_TYPE.net_gameModule2.bull100;\r\n                break;\r\n            case G_TYPE.gameModule.grab:\r\n                gameModel = G_TYPE.net_gameModule2.grab;\r\n                break;\r\n            case G_TYPE.gameModule.classic:\r\n                gameModel = G_TYPE.net_gameModule2.classic;\r\n            default:\r\n                break;\r\n        }\r\n        GG.httpMgr.sendHttpRequest(G_DIALOG_URL.gameRoomListUrl, 'gameModel=' +  gameModel, function (data) {\r\n            if(data){\r\n                data.enterType = enterType;\r\n                GG.platformMgr.showHomeList(true, isNoEffect);\r\n                GG.platformMgr.setHomeListInfo(data);\r\n            }\r\n        }.bind(this));\r\n    },\r\n\r\n    _getLocalData : function (enterType) {\r\n        var netData = {};\r\n        netData.enterType = enterType;\r\n        netData.data = [];\r\n        var interval = 2;\r\n        for(var i = 0; i < 6; i ++){\r\n            var roomInfo = {\r\n                id : i+1,   //房间ID\r\n                minLimitPlayerBlance : 1000,   //最大人数上限\r\n                currentPlayerCount : i * 50, //当前玩家数量\r\n            }\r\n            var rowNum = Math.ceil(roomInfo.id/interval);\r\n            roomInfo.minLimitPlayerBlance += rowNum * 1000;\r\n            netData.data.push(roomInfo);\r\n        }\r\n        return netData\r\n    },\r\n\r\n    //==================================\r\n\r\n    //从游戏房间返回大厅，需要先显示房间列表\r\n    showHomeListFirst : function (enterType, isNoEffect) {\r\n        // GG.platformMgr.showHomeList(true, isNoEffect);\r\n        this.showHomeList(enterType, isNoEffect);\r\n    },\r\n    _registerButton : function (node, callBack, target, userData, isNoScale) {\r\n        //if(!this._list_registerBtn) this._list_registerBtn = [];\r\n        var self = this;\r\n        node._isTouchEnabledEx = true;\r\n        //this._list_registerBtn.push([node, callBack, target]);\r\n        node.on(cc.Node.EventType.TOUCH_START, function (event) {\r\n            //if(event.target._isTouchEnabledEx) event.target.scale = G_Config_classic.scale_buttonTouch;\r\n            var aniNode = event.target.children[0];\r\n            if(event.target._isTouchEnabledEx && !isNoScale) {\r\n                self._setAniPause(aniNode, true);\r\n                event.target.scale = 1.1;\r\n                GG.audioMgr.playSound(17);\r\n            }\r\n        }, target);\r\n        node.on(cc.Node.EventType.TOUCH_END, function (event) {\r\n            var aniNode = event.target.children[0];\r\n            event.target.scale = 1;\r\n            self._setAniPause(aniNode, false);\r\n            if(event.target._isTouchEnabledEx) callBack.call(target, event, userData);\r\n        }, target);\r\n        node.on(cc.Node.EventType.TOUCH_CANCEL, function (event) {\r\n            var aniNode = event.target.children[0];\r\n            self._setAniPause(aniNode, false);\r\n            event.target.scale = 1;\r\n        }, target);\r\n    },\r\n\r\n    _setAniPause : function (node, isPause) {\r\n        var comp = node.getComponent(dragonBones.ArmatureDisplay);\r\n        if(isPause){\r\n            comp._lastTimeScale = comp.timeScale;\r\n            comp.timeScale = 0.01;\r\n        }else{\r\n            if(comp._lastTimeScale) comp.timeScale = comp._lastTimeScale;\r\n        }\r\n    },\r\n    _resumeAni : function (node) {\r\n\r\n    },\r\n\r\n    //移出屏幕外\r\n    moveOutScene : function (isOut, isNoEffect) {\r\n        if(!this._firstPosX) this._firstPosX = this.node.x;\r\n        var designSize = cc.sys.isMobile ? cc.view.getDesignResolutionSize() : cc.visibleRect;\r\n        if (isNoEffect) {\r\n            this.node.x = isOut ? this._firstPosX : designSize.width*2-this._firstPosX;\r\n            this.setFrameHide(isOut);\r\n        }else{\r\n            this._isTouchLimit = true;\r\n            this.node.active = true;\r\n            var time = 0.5;\r\n            this.node.stopAllActions();\r\n            var targetPos = cc.p(designSize.width*2-this._firstPosX, this.node.y);\r\n            if(isOut) targetPos.x = this._firstPosX\r\n            var self = this;\r\n            this.node.runAction(cc.sequence(cc.moveTo(time, targetPos), cc.callFunc(function () {\r\n                self._isTouchLimit = false;\r\n                self.setFrameHide(isOut);\r\n            })));\r\n        }\r\n    },\r\n\r\n    setFrameHide : function (isOut) {\r\n        this.node.active = !isOut;\r\n    },\r\n    // called every frame, uncomment this function to activate update callback\r\n    // update: function (dt) {\r\n\r\n    // },\r\n});\r\n"]}