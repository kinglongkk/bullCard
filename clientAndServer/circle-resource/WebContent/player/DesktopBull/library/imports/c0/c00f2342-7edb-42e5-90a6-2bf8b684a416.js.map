{"version":3,"sources":["assets\\Script\\Modules\\M_TopRequestLayer.js"],"names":["module","exports","cc","Class","properties","_ani","_isLoading","ctor","showNetRequest","isShowTip","self","_getRequestAni","layer_netAni","active","_showReconnectTip","aniNode","getChildByTag","ani","getComponent","dragonBones","ArmatureDisplay","playAnimation","closeNetRequest","callFunc","limitLayer","find","loader","loadRes","Prefab","err","prefab","canvas","Node","setContentSize","visibleRect","width","height","addChild","setName","addTouchLimit","instantiate","y","getIsShow","Boolean","isShow","tipNode","addComponent","Label","content","tableData","G_DATA","getChinese","string","target","on","EventType","TOUCH_START","_touchThisLayer","cancelTouchLimit","off"],"mappings":";;;;;;AAAA;;AAEAA,OAAOC,OAAP,GAAiBC,GAAGC,KAAH,CAAS;AACtBC,gBAAY;AACRC,cAAO,IADC,EACyC;AACjDC,oBAAa,IAFL,EADU;;AAMtB;AACAC,UAAM,gBAAY;AACd,aAAKD,UAAL,GAAkB,KAAlB;AACH,KATqB;;AAWtB;AACAE,oBAAiB,wBAAUC,SAAV,EAAqB;AAClC,YAAIC,OAAO,IAAX;AACA,aAAKC,cAAL,CAAoB,UAAUC,YAAV,EAAwB;AACxC,gBAAG,CAACA,YAAJ,EAAkB;AAClB,gBAAG,CAACA,aAAaC,MAAjB,EAAwB;AACpBD,6BAAaC,MAAb,GAAsB,IAAtB;AACAH,qBAAKI,iBAAL,CAAuBF,YAAvB,EAAqCH,SAArC;;AAEA,oBAAIM,UAAUH,aAAaI,aAAb,CAA2B,CAA3B,CAAd;AACA,oBAAGD,OAAH,EAAW;AACP,wBAAIE,MAAMF,QAAQG,YAAR,CAAqBC,YAAYC,eAAjC,CAAV;AACA,wBAAGH,GAAH,EAAQA,IAAII,aAAJ,CAAkB,EAAlB;AACX;AACJ;AACJ,SAZD;AAaH,KA3BqB;AA4BtB;AACAC,qBAAkB,2BAAY;AAC1B,YAAIZ,OAAO,IAAX;AACA,aAAKC,cAAL,CAAoB,UAAUC,YAAV,EAAwB;AACxC,gBAAG,CAACA,YAAJ,EAAkB;AAClBA,yBAAaC,MAAb,GAAsB,KAAtB;AACH,SAHD;AAIH,KAnCqB;;AAqCtB;AACAF,oBAAiB,wBAAUY,QAAV,EAAoB;AACjC,YAAIC,aAAatB,GAAGuB,IAAH,CAAQ,6BAAR,CAAjB;AACA,YAAGD,cAAcD,QAAjB,EAA0B;AACtBA,qBAASC,UAAT;AACAD,uBAAW,IAAX;AACH,SAHD,MAGK;AACD,gBAAG,KAAKjB,UAAR,EAAoB;AACpB,gBAAII,OAAO,IAAX;AACA,iBAAKJ,UAAL,GAAkB,IAAlB;AACAJ,eAAGwB,MAAH,CAAUC,OAAV,CAAkB,iCAAlB,EAAqDzB,GAAG0B,MAAxD,EAAgE,UAAUC,GAAV,EAAeC,MAAf,EAAuB;AACnF,oBAAGA,MAAH,EAAU;AACN,wBAAIC,SAAS7B,GAAGuB,IAAH,CAAQ,QAAR,CAAb;AACAD,iCAAa,IAAItB,GAAG8B,IAAP,EAAb;AACAR,+BAAWS,cAAX,CAA0B/B,GAAGgC,WAAH,CAAeC,KAAzC,EAAgDjC,GAAGgC,WAAH,CAAeE,MAA/D;AACAL,2BAAOM,QAAP,CAAgBb,UAAhB,EAA4B,CAA5B;AACAA,+BAAWc,OAAX,CAAmB,sBAAnB;AACA5B,yBAAK6B,aAAL,CAAmBf,UAAnB;;AAEA,wBAAIP,MAAMf,GAAGsC,WAAH,CAAeV,MAAf,CAAV;AACAb,wBAAIwB,CAAJ,GAAQvC,GAAGgC,WAAH,CAAeE,MAAf,GAAwB,GAAhC;AACAZ,+BAAWa,QAAX,CAAoBpB,GAApB,EAAyB,CAAzB,EAA4B,CAA5B;AACH;AACDP,qBAAKJ,UAAL,GAAkB,KAAlB;AACA,oBAAGiB,QAAH,EAAY;AACRA,6BAASC,UAAT;AACAD,+BAAW,IAAX;AACH;AACJ,aAlBD;AAmBH;AACJ,KAnEqB;;AAqEtBmB,eAAY,qBAAY;AACpB,YAAI9B,eAAeV,GAAGuB,IAAH,CAAQ,6BAAR,CAAnB;AACA,eAAOkB,QAAQ/B,gBAAgBA,aAAaC,MAArC,CAAP;AACH,KAxEqB;;AA0EtB;AACAC,uBAAoB,2BAAUF,YAAV,EAAwBgC,MAAxB,EAAgC;AAChD,YAAIC,UAAUjC,aAAaI,aAAb,CAA2B,CAA3B,CAAd;AACA,YAAG,CAAC6B,OAAJ,EAAY;AACRA,sBAAU,IAAI3C,GAAG8B,IAAP,EAAV;AACAa,oBAAQC,YAAR,CAAqB5C,GAAG6C,KAAxB;AACAF,oBAAQJ,CAAR,GAAY,CAACvC,GAAGgC,WAAH,CAAeE,MAAhB,GAAyB,GAArC;AACAxB,yBAAayB,QAAb,CAAsBQ,OAAtB,EAA+B,CAA/B,EAAkC,CAAlC;AACH;AACD,YAAIG,OAAJ;AACA,YAAGJ,MAAH,EAAW;AACP,gBAAIK,YAAYC,OAAOC,UAAP,CAAkB,EAAlB,CAAhB;AACAH,sBAASC,UAAUD,OAAnB;AACH,SAHD,MAGMA,UAAU,EAAV;AACNH,gBAAQ3B,YAAR,CAAqBhB,GAAG6C,KAAxB,EAA+BK,MAA/B,GAAwCJ,OAAxC;AACH,KAzFqB;;AA2FtBT,mBAAgB,uBAAUc,MAAV,EAAkB;AAC9B,YAAG,CAACA,MAAJ,EAAYA,SAASnD,GAAGuB,IAAH,CAAQ,6BAAR,CAAT;AACZ,YAAG4B,MAAH,EAAWA,OAAOC,EAAP,CAAUpD,GAAG8B,IAAH,CAAQuB,SAAR,CAAkBC,WAA5B,EAAyC,KAAKC,eAA9C,EAA+D,IAA/D;AACd,KA9FqB;AA+FtBA,qBAAkB,2BAAY,CAE7B,CAjGqB;AAkGtBC,sBAAmB,0BAAUL,MAAV,EAAkB;AACjC,YAAG,CAACA,MAAJ,EAAYA,SAASnD,GAAGuB,IAAH,CAAQ,6BAAR,CAAT;AACZ,YAAG4B,MAAH,EAAWA,OAAOM,GAAP,CAAWzD,GAAG8B,IAAH,CAAQuB,SAAR,CAAkBC,WAA7B,EAA0C,KAAKC,eAA/C,EAAgE,IAAhE;AACd;AArGqB,CAAT,CAAjB","file":"unknown","sourcesContent":["//最上面的网络请求动画\r\n\r\nmodule.exports = cc.Class({\r\n    properties: {\r\n        _ani : null,                                     //加载动画\r\n        _isLoading : null,                              //正在加载\r\n    },\r\n\r\n    // use this for initialization\r\n    ctor: function () {\r\n        this._isLoading = false;\r\n    },\r\n\r\n    //显示网络请求动画\r\n    showNetRequest : function (isShowTip) {\r\n        var self = this;\r\n        this._getRequestAni(function (layer_netAni) {\r\n            if(!layer_netAni) return;\r\n            if(!layer_netAni.active){\r\n                layer_netAni.active = true;\r\n                self._showReconnectTip(layer_netAni, isShowTip);\r\n\r\n                var aniNode = layer_netAni.getChildByTag(1);\r\n                if(aniNode){\r\n                    var ani = aniNode.getComponent(dragonBones.ArmatureDisplay);\r\n                    if(ani) ani.playAnimation('');\r\n                }\r\n            }\r\n        })\r\n    },\r\n    //隐藏动画\r\n    closeNetRequest : function () {\r\n        var self = this;\r\n        this._getRequestAni(function (layer_netAni) {\r\n            if(!layer_netAni) return;\r\n            layer_netAni.active = false;\r\n        })\r\n    },\r\n\r\n    //获取播放的动画\r\n    _getRequestAni : function (callFunc) {\r\n        var limitLayer = cc.find('Canvas/layer_loadingRequest');\r\n        if(limitLayer && callFunc){\r\n            callFunc(limitLayer);\r\n            callFunc = null;\r\n        }else{\r\n            if(this._isLoading) return;\r\n            var self = this;\r\n            this._isLoading = true;\r\n            cc.loader.loadRes('ani_prefab/Prefab_simpleLoading', cc.Prefab, function (err, prefab) {\r\n                if(prefab){\r\n                    var canvas = cc.find('Canvas');\r\n                    limitLayer = new cc.Node();\r\n                    limitLayer.setContentSize(cc.visibleRect.width, cc.visibleRect.height);\r\n                    canvas.addChild(limitLayer, 3);\r\n                    limitLayer.setName('layer_loadingRequest');\r\n                    self.addTouchLimit(limitLayer);\r\n\r\n                    var ani = cc.instantiate(prefab);\r\n                    ani.y = cc.visibleRect.height * 0.2;\r\n                    limitLayer.addChild(ani, 1, 1);\r\n                }\r\n                self._isLoading = false;\r\n                if(callFunc){\r\n                    callFunc(limitLayer);\r\n                    callFunc = null;\r\n                }\r\n            })\r\n        }\r\n    },\r\n\r\n    getIsShow : function () {\r\n        var layer_netAni = cc.find('Canvas/layer_loadingRequest');\r\n        return Boolean(layer_netAni && layer_netAni.active)\r\n    },\r\n\r\n    //显示重连提示\r\n    _showReconnectTip : function (layer_netAni, isShow) {\r\n        var tipNode = layer_netAni.getChildByTag(2);\r\n        if(!tipNode){\r\n            tipNode = new cc.Node();\r\n            tipNode.addComponent(cc.Label);\r\n            tipNode.y = -cc.visibleRect.height * 0.1;\r\n            layer_netAni.addChild(tipNode, 0, 2);\r\n        }\r\n        var content;\r\n        if(isShow) {\r\n            var tableData = G_DATA.getChinese(61);\r\n            content =tableData.content;\r\n        }else content = '';\r\n        tipNode.getComponent(cc.Label).string = content;\r\n    },\r\n\r\n    addTouchLimit : function (target) {\r\n        if(!target) target = cc.find('Canvas/layer_loadingRequest');\r\n        if(target) target.on(cc.Node.EventType.TOUCH_START, this._touchThisLayer, this);\r\n    },\r\n    _touchThisLayer : function () {\r\n\r\n    },\r\n    cancelTouchLimit : function (target) {\r\n        if(!target) target = cc.find('Canvas/layer_loadingRequest');\r\n        if(target) target.off(cc.Node.EventType.TOUCH_START, this._touchThisLayer, this);\r\n    },\r\n});\r\n"]}