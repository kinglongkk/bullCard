{"version":3,"sources":["assets\\Script\\Objects\\Obj_goldsContainer.js"],"names":["cc","Class","extends","Component","properties","_dict_goldSort","frame_gold","default","type","SpriteFrame","displayName","onLoad","_goldMoveTime","_recoveGoldMoveTime","_goldScale","G_Config_common","scale_moveGold","start","GG","curMgr","_tableContainer","getTableContainer","playerToTable","dataObj","goldPosList","getGoldPosList","tableIndex","goldNum","targetPos","goldNode","lastGold","i","_getOneGold","_addFlyAction","startPos","push","audioMgr","playSound","callBack","callFunc","tableToPlayer","goldList","_getRemoveGold","_addFlyAction2","recoverAllGold","isHaveGold","concat","length","splice","flyInfo","position","act","moveTo","runAction","sequence","_goldFlyEnd","isRemove","_removeGold","_pool","NodePool","get","Node","sp","addComponent","Sprite","spriteFrame","parent","node","scale","active","goldeNode","stopAllActions","put","getGoldSize","_goldSize","gold","getContentSize","clearAll","children","onDestroy","clear"],"mappings":"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","file":"unknown","sourcesContent":["//金币管理容器\r\n\r\ncc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        //_isUpdate : null,                                                           //是否开启金币的移动\r\n        _dict_goldSort : null,                                                      //已经投注的金币的整理字典\r\n\r\n        frame_gold : {\r\n            default : null,\r\n            type : cc.SpriteFrame,\r\n            displayName : '金币图标'\r\n        },\r\n    },\r\n\r\n    // use this for initialization\r\n    onLoad: function () {\r\n        //金币的移动时间\r\n        this._goldMoveTime = 0.3;\r\n        //胜利金币回收的移动速度\r\n        this._recoveGoldMoveTime = 0.4;\r\n        //金币的缩放\r\n        this._goldScale = G_Config_common.scale_moveGold;\r\n\r\n        this._dict_goldSort = {};\r\n    },\r\n\r\n    start : function () {\r\n        if(GG.curMgr) this._tableContainer = GG.curMgr.getTableContainer();\r\n    },\r\n\r\n    //从玩家到投注区域\r\n    playerToTable : function (dataObj) {\r\n        //var dataObj = G_OBJ.data_flyGold_playerToTable();\r\n        var goldPosList = this._tableContainer.getGoldPosList(dataObj.tableIndex, dataObj.goldNum);\r\n        var targetPos, goldNode, lastGold;\r\n        for(var i = 0; i < dataObj.goldNum; i ++){\r\n            targetPos = goldPosList[i];\r\n            if(targetPos){\r\n                goldNode = this._getOneGold();\r\n                this._addFlyAction(goldNode, {\r\n                    startPos : dataObj.startPos,\r\n                    targetPos : targetPos\r\n                })\r\n                if(!this._dict_goldSort[dataObj.tableIndex]) this._dict_goldSort[dataObj.tableIndex] = [];\r\n                this._dict_goldSort[dataObj.tableIndex].push(goldNode);\r\n                lastGold = goldNode;\r\n            }\r\n        }\r\n        if(dataObj.goldNum > 0) GG.audioMgr.playSound(15);\r\n        if(lastGold) lastGold.callBack = dataObj.callFunc;\r\n    },\r\n    //从投注区域到玩家\r\n    tableToPlayer : function (dataObj) {\r\n        //var dataObj = G_OBJ.data_flyGold_tableToPlayer();\r\n        var goldList = this._getRemoveGold(dataObj.tableIndex, dataObj.goldNum);\r\n        var goldNode;\r\n        for(var i = 0; i < dataObj.goldNum; i ++){\r\n            goldNode = goldList[i];\r\n            if(goldNode){\r\n                this._addFlyAction2(goldNode, {\r\n                    //startPos : startPos,  //可以让其从当前的位置出发\r\n                    targetPos : dataObj.targetPos\r\n                })\r\n            }\r\n        }\r\n        //if(dataObj.goldNum > 0) GG.audioMgr.playSound(18);\r\n    },\r\n\r\n    //回收剩余的金币\r\n    recoverAllGold : function (targetPos) {\r\n        var goldList = [], isHaveGold = false;\r\n        for(var tableIndex in this._dict_goldSort){\r\n            if(this._dict_goldSort[tableIndex]) goldList = goldList.concat(this._dict_goldSort[tableIndex]);\r\n        }\r\n        this._dict_goldSort = {};\r\n        var goldNode;\r\n        for(var i = 0; i < goldList.length; i ++){\r\n            goldNode = goldList[i];\r\n            if(goldNode){\r\n                isHaveGold = true;\r\n                this._addFlyAction2(goldNode, {\r\n                    //startPos : startPos,  //可以让其从当前的位置出发\r\n                    targetPos : targetPos\r\n                })\r\n            }\r\n        }\r\n        //if(goldList.length > 0) GG.audioMgr.playSound(18);\r\n        return isHaveGold\r\n    },\r\n\r\n    //从一个投注区域中获取随机的几个金币,用于回收移动\r\n    _getRemoveGold : function (tableIndex, goldNum) {\r\n        if(!this._dict_goldSort[tableIndex]) return []\r\n        if(goldNum >= this._dict_goldSort[tableIndex].length) {\r\n            var goldList = this._dict_goldSort[tableIndex].concat([]);\r\n            this._dict_goldSort[tableIndex] = null;\r\n            return goldList\r\n        }else{\r\n            return this._dict_goldSort[tableIndex].splice(0,goldNum);\r\n        }\r\n    },\r\n\r\n    //增加一个金币移动的动作---投注金币\r\n    _addFlyAction : function (goldNode, flyInfo) {\r\n        var startPos = flyInfo.startPos;\r\n        var targetPos = flyInfo.targetPos;\r\n        if(startPos) goldNode.position = startPos;\r\n        // var act = cc.moveTo(this._goldMoveTime, targetPos).easing(cc.easeOut(3.0));\r\n        var act = cc.moveTo(this._goldMoveTime, targetPos);\r\n        goldNode.runAction(cc.sequence(act, cc.callFunc(this._goldFlyEnd, this, flyInfo.isRemove)));\r\n    },\r\n    //增加一个金币移动的动作---回收金-币\r\n    _addFlyAction2 : function (goldNode, flyInfo) {\r\n        var startPos = flyInfo.startPos;\r\n        var targetPos = flyInfo.targetPos;\r\n        if(startPos) goldNode.position = startPos;\r\n        var act = cc.moveTo(this._recoveGoldMoveTime, targetPos);\r\n        goldNode.runAction(cc.sequence(act, cc.callFunc(this._goldFlyEnd, this, true)));\r\n    },\r\n    //金币移动结束\r\n    _goldFlyEnd : function (goldNode, isRemove) {\r\n        if(goldNode.callBack){\r\n            goldNode.callBack();\r\n            goldNode.callBack = null;\r\n        }\r\n\r\n        if(isRemove){\r\n            this._removeGold(goldNode);\r\n        }\r\n    },\r\n\r\n    //===================\r\n\r\n    //获取一个金币\r\n    _getOneGold : function () {\r\n        if(!this.frame_gold) return null;\r\n        if(!this._pool) this._pool = new cc.NodePool('Obj_goldContainer');\r\n\r\n        var goldNode = this._pool.get();\r\n        if(!goldNode){\r\n            goldNode = new cc.Node();\r\n            var sp = goldNode.addComponent(cc.Sprite);\r\n            sp.spriteFrame = this.frame_gold;\r\n        }\r\n        goldNode.parent = this.node;\r\n        //goldNode.scale = (1/this.node.parent.scale)*this._goldScale;\r\n        goldNode.scale = this._goldScale;\r\n        goldNode.active = true;\r\n        return goldNode;\r\n    },\r\n    //移除金币\r\n    _removeGold : function (goldeNode) {\r\n        goldeNode.stopAllActions();\r\n        goldeNode.active = false;\r\n        this._pool.put(goldeNode);\r\n    },\r\n\r\n    getGoldSize : function () {\r\n        if(!this._goldSize){\r\n            var gold = this._getOneGold();\r\n            this._goldSize = gold.getContentSize();\r\n            this._removeGold(gold);\r\n        }\r\n        return this._goldSize\r\n    },\r\n\r\n    //清理所有\r\n    clearAll : function () {\r\n        var goldList = this.node.children;\r\n        for(var i = goldList.length-1; i >= 0; i --){\r\n            this._removeGold(goldList[i]);\r\n        }\r\n\r\n        this._dict_goldSort = {};\r\n        this.node.stopAllActions();\r\n    },\r\n\r\n    // called every frame, uncomment this function to activate update callback\r\n    // update: function (dt) {\r\n\r\n    // },\r\n\r\n    onDestroy : function () {\r\n        if(this._pool){\r\n            this._pool.clear();\r\n        }\r\n    },\r\n});\r\n"]}