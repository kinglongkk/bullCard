{"version":3,"sources":["assets\\Script\\Common\\Global.js"],"names":["gg","window","GG","classicMgr","grabMgr","platformMgr","bull100Mgr","getModuleMgr","mgrList","i","length","curMgr","tipsMgr","resMgr","_player","getPlayer","player","require","getPlayerID","httpMgr","http","socketMgr","socket","tableMgr","audioMgr","Listener","topTouchLayer","topLayer","mgr","s_requestMgr","webHandler","handler","getGameState","_gameState","getGameType","canvas","cc","find","startComp","getComponent","exitHome","dataObj","gameType","setOutHomeData","G_DATA","setCurSceneHash","changeScene","G_TYPE","sceneName","platform","exitGame","sendHttpRequest","G_DIALOG_URL","logout","data","director","end","location","replace","href","bind","setReloadSceneInfo","preloadScene","loadScene","showReconnect","callFunc","tableData","getChinese","showConfirmTip_TWO","content","getIsLoading","_isLoading","setIsLoading","isLoading","loginSocket","func","SendMsg","NetType","s_login","token","getPlayerToken","userId","getUID","_isFirstEnterPlatform","whenGameStart","callBack","game","config","showFPS","webGameState","running","sys","isNative","document","gameStart","on","EVENT_HIDE","_pauseWebGame","EVENT_SHOW","_resumeWebGame","tables","push","G_RES_URL","dict_tablesName","commonConfig","chinese","audioName","grabConfig","reloadTables","reloadPlatformAudio","pause","audioEngine","pauseAll","stopMusic","whenPauseGame","garbageCollect","resumeAll","playMusic","whenResumeGame","parsePauseInfo"],"mappings":"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","file":"unknown","sourcesContent":["//配置全局使用的管理器\r\nvar gg = gg || {};\r\nwindow.GG = gg;\r\n\r\n//经典对战管理器\r\nGG.classicMgr = null;\r\n//夺宝对战\r\nGG.grabMgr = null;\r\n//大厅管理\r\nGG.platformMgr = null;\r\n//百人大战管理\r\nGG.bull100Mgr = null;\r\n//获取当前游戏的管理器--------------------每次推出场景，需要将当前的场景管理器置空\r\nGG.getModuleMgr = function () {\r\n    var mgrList = [GG.grabMgr, GG.classicMgr, GG.platformMgr, GG.bull100Mgr];\r\n    for(var i = 0; i < mgrList.length; i ++){\r\n        if(mgrList[i]) return mgrList[i];\r\n    }\r\n    return null;\r\n}\r\nGG.curMgr = null;\r\n\r\n\r\n//弹窗提示管理器\r\nGG.tipsMgr = null;\r\n//所有预加载资源管理\r\nGG.resMgr = null;\r\n\r\n\r\n//=======================================================\r\n\r\n//玩家对象\r\nGG._player = null;\r\nGG.getPlayer = function () {\r\n    if(!this._player){\r\n        var player = require('M_Player');\r\n        this._player = new player();\r\n    }\r\n    return this._player;\r\n}\r\nGG.getPlayerID = function () {\r\n    return this.getPlayer().getPlayerID();\r\n}\r\n//弱联网管理器\r\nGG.httpMgr = GG.httpMgr || (function () {\r\n        var http = require('HTTPMgr');\r\n        return new http()\r\n    })();\r\n\r\n//socket网络请求管理器\r\nGG.socketMgr =  GG.socketMgr || (function () {\r\n        var socket = require('SocketMgr');\r\n        return new socket()\r\n    })();\r\n\r\n//配置文件管理器\r\nGG.tableMgr =  GG.tableMgr || (function () {\r\n        var tableMgr = require('TablesMgr');\r\n        return new tableMgr()\r\n    })();\r\n\r\n//配置文件管理器\r\nGG.audioMgr =  GG.audioMgr || (function () {\r\n        var audioMgr = require('AudioMgr');\r\n        return new audioMgr()\r\n    })();\r\n\r\n//全局的监听管理\r\nGG.Listener =  GG.Listener || (function () {\r\n        var Listener = require('Global_listener');\r\n        return new Listener()\r\n    })();\r\n//最上面的触摸层\r\nGG.topTouchLayer = GG.topTouchLayer || (function () {\r\n        var topLayer = require('M_TopRequestLayer');\r\n        return new topLayer()\r\n    })();\r\n\r\n//资源管理器\r\nGG.resMgr = GG.resMgr || (function () {\r\n        var mgr = require('ReloadResMgr');\r\n        return new mgr()\r\n    })()\r\n\r\n//socket数据请求管理器\r\nGG.s_requestMgr = GG.s_requestMgr || (function () {\r\n        var mgr = require('SocketRequestMgr');\r\n        return new mgr()\r\n    })()\r\n\r\n//web相关操作\r\nGG.webHandler = GG.webHandler || (function () {\r\n        var handler = require('WebMobile_handler');\r\n        return new handler();\r\n    })()\r\n\r\n//=========================\r\n\r\n//当前的游戏状态\r\nGG.getGameState = function(){\r\n    return this._gameState\r\n}\r\n\r\n//当前的游戏模式\r\nGG.getGameType = function(){\r\n    var canvas = cc.find('Canvas');\r\n    if(canvas){\r\n        var startComp = canvas.getComponent('GameStart');\r\n        if(startComp){\r\n            return startComp.getGameType()\r\n        }\r\n    }\r\n    return null\r\n}\r\n\r\n//退出赛事所在的房间\r\nGG.exitHome = function () {\r\n    //需要增加一个正在退出的逻辑，给释放缓存一定的时间\r\n    var dataObj = {\r\n        gameType : this.getGameType(),\r\n    }\r\n    this.getPlayer().setOutHomeData(dataObj);\r\n    G_DATA.setCurSceneHash('',0);\r\n    GG.changeScene(G_TYPE.sceneName.platform);\r\n}\r\n\r\n//退出游戏\r\nGG.exitGame = function () {\r\n    GG.httpMgr.sendHttpRequest(G_DIALOG_URL.logout, null, function (data) {\r\n        if(data){\r\n            cc.director.end();\r\n            location.replace(location.href)\r\n        }\r\n    }.bind(this));\r\n}\r\n\r\n//加载场景\r\nGG.changeScene = function (sceneName) {\r\n    GG.getPlayer().setReloadSceneInfo({\r\n        sceneName : sceneName\r\n    });\r\n    cc.director.preloadScene('InHomeLoading', function () {\r\n        cc.director.loadScene('InHomeLoading');\r\n    });\r\n};\r\n\r\n//发起是否重连的请求; callFunc : 点击确定后的回调\r\nGG.showReconnect = function (callFunc) {\r\n    if(GG.tipsMgr){\r\n        var tableData = G_DATA.getChinese(62);\r\n        GG.tipsMgr.showConfirmTip_TWO(tableData.content, callFunc, function () {\r\n            //直接关闭游戏\r\n            cc.director.end();\r\n            location.replace(location.href)\r\n        });\r\n    }\r\n}\r\n\r\n//是否正在加载中\r\nGG.getIsLoading = function () {\r\n    return this._isLoading\r\n}\r\n//正在加载中\r\nGG.setIsLoading = function (isLoading) {\r\n    this._isLoading = isLoading;\r\n}\r\n//登陆socket\r\nGG.loginSocket = function (func) {\r\n    //登陆socket\r\n    GG.socketMgr.SendMsg(NetType.s_login,{\r\n        token : GG.getPlayer().getPlayerToken(),\r\n        userId : GG.getPlayer().getUID()\r\n    }, func);\r\n};\r\n\r\nGG._isFirstEnterPlatform = true;\r\nGG._gameState = null;//游戏暂停和开始的状态\r\n//刚登陆后的处理\r\nGG.whenGameStart = function (callBack) {\r\n    if(!GG._isFirstEnterPlatform) return false;\r\n    cc.game.config.showFPS = false;\r\n    //初次进入游戏\r\n    GG._isFirstEnterPlatform = false;\r\n    //自由旋转\r\n    // cc.view.setOrientation(cc.macro.ORIENTATION_AUTO);\r\n    //增加游戏暂停和开始的监听\r\n    this._gameState = G_TYPE.webGameState.running;\r\n    if(!cc.sys.isNative && document){\r\n        GG.webHandler.gameStart();\r\n    }else{\r\n        cc.game.on(cc.game.EVENT_HIDE, this._pauseWebGame, this);\r\n        cc.game.on(cc.game.EVENT_SHOW, this._resumeWebGame, this);\r\n    }\r\n\r\n    //加载表格配置\r\n    var tables = [];\r\n    tables.push(G_RES_URL.dict_tablesName.commonConfig);\r\n    tables.push(G_RES_URL.dict_tablesName.chinese);\r\n    tables.push(G_RES_URL.dict_tablesName.audioName);\r\n    tables.push(G_RES_URL.dict_tablesName.grabConfig);\r\n    GG.tableMgr.reloadTables(tables, function () {\r\n        //加载音效配置\r\n        GG.audioMgr.reloadPlatformAudio(function () {\r\n            if(callBack){\r\n                callBack();\r\n                callBack = null;\r\n\r\n            }\r\n        })\r\n    });\r\n\r\n    // cc.game.setFrameRate(49);\r\n    return true\r\n}\r\nGG._pauseWebGame = function () {\r\n    if(this._gameState == G_TYPE.webGameState.pause) return;\r\n    this._gameState = G_TYPE.webGameState.pause;\r\n    //cc.Audio.useWebAudio = true\r\n    cc.audioEngine.pauseAll();\r\n    GG.audioMgr.stopMusic();\r\n    var mgr = GG.curMgr;\r\n    if(mgr && mgr.whenPauseGame){\r\n        mgr.whenPauseGame();\r\n    }\r\n    cc.sys.garbageCollect();\r\n};\r\nGG._resumeWebGame = function () {\r\n    if(this._gameState == G_TYPE.webGameState.running) return;\r\n    this._gameState = G_TYPE.webGameState.running;\r\n    cc.audioEngine.resumeAll();\r\n    GG.audioMgr.playMusic();\r\n    var mgr = GG.curMgr;\r\n    if(mgr && mgr.whenResumeGame){\r\n        mgr.whenResumeGame();\r\n    }\r\n    GG.socketMgr.parsePauseInfo();\r\n};"]}