{"version":3,"sources":["assets\\Script\\Views\\Scene_Grab\\Grab_pokerLayer.js"],"names":["cc","Class","extends","Component","properties","_pokerShowPos","_pokerNum","_StartPos","_pokerW","_pokerH","_pokerOffX","_callFunc","_curResultNum","_list_pokers","_firstPokerIndex","prefab_poker","Prefab","atlas_pokerResult","default","type","SpriteAtlas","displayName","prefab_pokerResult","onLoad","_init","_pokerCompName","_pokerResultCompName","_moveTime","G_Config_grab","time_pokerMove","_delayTime","delayTime_pokerMove","_openMoveTime","time_openMovePoker","_winPokerOff","num_winPokerOff","_maxPokerNum","setStartInfo","startPos","targetPos","p","x","y","clearData","node","stopAllActions","_flyNum","i","_delOnePoker","_pokerResult","destroy","showPokerEX","dataObj","isFlyEffect","_showPokerEX","self","setTimeout","GG","grabMgr","getPokerShowPos","pokerResult","pokerList","pokerInfoList","lastPoker","startPokerIndex","_addOnePokerEX","pokerIndex","length","_flyCall","callFunc","audioMgr","playSound","pokerData","poker","_createPoker","zIndex","_resetPokerInfo","getComponent","clearAllActions","showPokerNegative","active","position","_addFlyAction","isOpen","_addNoFly","showPokerPlus","instantiate","parent","pokerNode","pokerInfo","G_DATA","getPokerInfo","pokerComp","setPokerInfo","pokerType","pokerValue","_setPokerConfigInfo","act1","delayTime","act3","moveTo","_getTargetPos","runAction","sequence","_moveEnd","target","openPoker","pokerSize","getPokerSize","width","scaleX","height","num_pokerOffX","_resetFirstPokerInfo","openPokers","index","posX","sortList","children","offX","_actOpenPoker","_showResult","bind","audioID","pokerPos","result","addChild","showResult","_showResultEnd","getPokerNum"],"mappings":"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","file":"unknown","sourcesContent":["//卡牌活动层\r\n\r\ncc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        _pokerShowPos : null,\r\n        _pokerNum : null,\r\n        _StartPos : null,\r\n        _pokerW : null,\r\n        _pokerH : null,                                                                                                     //卡牌的高\r\n        _pokerOffX : null,\r\n        _callFunc : null,\r\n        _curResultNum : null,\r\n\r\n        //=================卡牌容器重构\r\n        _list_pokers : null,\r\n        _firstPokerIndex : null,                                                                                           //展示结果的时候，第一张卡牌的信息变化了\r\n\r\n\r\n        prefab_poker : cc.Prefab,\r\n        atlas_pokerResult : {\r\n            default : null,\r\n            type : cc.SpriteAtlas,\r\n            displayName : '显示牛几图集'\r\n        },\r\n        prefab_pokerResult : {\r\n            default : null,\r\n            type : cc.Prefab,\r\n            displayName : '显示牛几结果'\r\n        }\r\n    },\r\n\r\n    // use this for initialization\r\n    onLoad: function () {\r\n        this._init();\r\n    },\r\n\r\n    _init : function () {\r\n        this._pokerCompName = 'Obj_poker';\r\n        this._pokerResultCompName = 'Obj_onPokerResult';\r\n        this._moveTime = G_Config_grab.time_pokerMove;\r\n        this._delayTime = G_Config_grab.delayTime_pokerMove;\r\n        this._openMoveTime = G_Config_grab.time_openMovePoker;\r\n        this._winPokerOff = G_Config_grab.num_winPokerOff;\r\n        this._maxPokerNum = 5;\r\n        this._pokerNum = 0;\r\n        //重构\r\n        this._list_pokers = [];\r\n    },\r\n\r\n    setStartInfo : function (startPos, targetPos) {\r\n        this._StartPos = startPos;\r\n        this._pokerShowPos = cc.p(targetPos.x, targetPos.y);\r\n        // if(this._pokerW) this._pokerShowPos = cc.p(this._pokerShowPos.x-this._pokerW*0.5, this._pokerShowPos.y-this._pokerH*0.5);\r\n        if(this._pokerW) this._pokerShowPos = cc.p(this._pokerShowPos.x, this._pokerShowPos.y);\r\n    },\r\n    clearData : function () {\r\n        this.node.stopAllActions();\r\n        this._pokerNum = 0;\r\n        this._flyNum = 0;\r\n\r\n        for(var i = 0; i < this._maxPokerNum; i ++){\r\n            if(this._list_pokers[i]) this._delOnePoker(this._list_pokers[i]);\r\n        }\r\n        if(this._pokerResult){\r\n            this._pokerResult.destroy();\r\n            this._pokerResult = null;\r\n        }\r\n    },\r\n\r\n    // 显示卡牌\r\n    showPokerEX : function (dataObj) {\r\n        if(dataObj.isFlyEffect){\r\n            this._showPokerEX(dataObj);\r\n        }else{\r\n            var self = this;\r\n            setTimeout(function () {\r\n                self._showPokerEX(dataObj);\r\n            },100)\r\n        }\r\n    },\r\n    _showPokerEX : function (dataObj) {\r\n        //var dataObj = G_OBJ.data_grabPokerInfo();\r\n        //这幅卡牌结果值(没有传值的话，默认最终卡牌值为0)\r\n        this._pokerShowPos = GG.grabMgr.getPokerShowPos();\r\n        this._curResultNum = dataObj.pokerResult ? dataObj.pokerResult : 0;\r\n        //卡牌信息\r\n        this._flyNum = 0;\r\n        var pokerList = dataObj.pokerInfoList;\r\n        if(pokerList){\r\n            var lastPoker;\r\n            if(dataObj.startPokerIndex == 1){\r\n                //显示第一张卡牌\r\n                this._pokerNum = 0;\r\n                lastPoker = this._addOnePokerEX(0, pokerList[0], dataObj.isFlyEffect);\r\n            }else{\r\n                //取其余四张信息\r\n                this._firstPokerIndex = pokerList[0].pokerIndex;\r\n                for(var i = 1; i < pokerList.length; i ++){\r\n                    lastPoker = this._addOnePokerEX(i, pokerList[i], dataObj.isFlyEffect);\r\n                }\r\n            }\r\n            if(lastPoker) lastPoker._flyCall = dataObj.callFunc;\r\n            GG.audioMgr.playSound(14);\r\n        }\r\n    },\r\n\r\n    //增加一张卡牌\r\n    _addOnePokerEX : function (pokerIndex, pokerData, isFlyEffect) {\r\n        var poker = this._list_pokers[pokerIndex];\r\n        if(!poker){\r\n            poker = this._createPoker();\r\n            poker.zIndex = pokerIndex;\r\n            this._list_pokers[pokerIndex] = poker;\r\n        }\r\n        //卡牌信息\r\n        this._resetPokerInfo(poker, pokerData.pokerIndex);\r\n        //飞行表现\r\n        poker.getComponent(this._pokerCompName).clearAllActions();\r\n        poker.getComponent(this._pokerCompName).showPokerNegative();\r\n        poker.active = true;\r\n        if(isFlyEffect){\r\n            //有飞行特效\r\n            poker.position = this._StartPos;\r\n            this._addFlyAction(poker, pokerData.isOpen);\r\n        }else{\r\n            //没有飞行特效\r\n            this._addNoFly(poker);\r\n            if(pokerData.isOpen) poker.getComponent(this._pokerCompName).showPokerPlus();\r\n        }\r\n        this._pokerNum += 1;\r\n        this._flyNum += 1;\r\n        return poker\r\n    },\r\n\r\n    //=======================================\r\n\r\n    //增加一张卡牌，纯粹的创建\r\n    _createPoker : function () {\r\n        var  poker = new cc.instantiate(this.prefab_poker);\r\n        poker.parent = this.node;\r\n        //poker.scale = 0.5;\r\n        poker.active = true;\r\n        return poker\r\n    },\r\n    //刷新卡牌数据\r\n    _resetPokerInfo : function (pokerNode, pokerIndex) {\r\n        var pokerInfo = G_DATA.getPokerInfo(pokerIndex);\r\n        var pokerComp = pokerNode.getComponent(this._pokerCompName);\r\n        pokerComp.setPokerInfo(pokerInfo.pokerType, pokerInfo.pokerValue, false);\r\n    },\r\n    //给卡牌增加动作\r\n    _addFlyAction : function (pokerNode, isOpen) {\r\n        var pokerComp = pokerNode.getComponent(this._pokerCompName);\r\n\r\n        if(!this._pokerW) this._setPokerConfigInfo(pokerNode);\r\n        var act1 = cc.delayTime(this._delayTime*this._flyNum);\r\n        var act3 = cc.moveTo(this._moveTime, this._getTargetPos());\r\n        pokerNode.runAction(cc.sequence(act1, act3, cc.callFunc(this._moveEnd, this, isOpen)));\r\n    },\r\n    //卡牌做无飞行效果显示\r\n    _addNoFly : function (pokerNode) {\r\n        if(!this._pokerW) this._setPokerConfigInfo(pokerNode);\r\n        pokerNode.position = this._getTargetPos();\r\n    },\r\n    _moveEnd : function (target, isOpen) {\r\n        if(isOpen){\r\n            var pokerComp = target.getComponent(this._pokerCompName);\r\n            pokerComp.openPoker();\r\n        }\r\n        if(target._flyCall){\r\n            target._flyCall();\r\n            target._flyCall = null;\r\n        }\r\n    },\r\n\r\n    _setPokerConfigInfo : function (poker) {\r\n        var pokerComp = poker.getComponent(this._pokerCompName);\r\n        var pokerSize = pokerComp.getPokerSize();\r\n        this._pokerW = pokerSize.width * poker.scaleX;\r\n        this._pokerH = pokerSize.height * poker.scaleX;\r\n        this._pokerOffX = this._pokerW * G_Config_grab.num_pokerOffX;\r\n        // this._pokerShowPos = cc.p(this._pokerShowPos.x-this._pokerW*0.5, this._pokerShowPos.y-this._pokerH*0.5);\r\n        this._pokerShowPos = cc.p(this._pokerShowPos.x, this._pokerShowPos.y);\r\n    },\r\n\r\n    //重新设置第一张卡牌信息\r\n    _resetFirstPokerInfo : function () {\r\n        if(this._list_pokers[0]) this._resetPokerInfo(this._list_pokers[0], this._firstPokerIndex);\r\n    },\r\n\r\n    //开牌==============================\r\n    openPokers : function (callFunc) {\r\n        this._callFunc = callFunc;\r\n        //重置第一张牌信息\r\n        this._resetFirstPokerInfo();\r\n        //开始播放开牌\r\n        var poker, index= 0, lastPoker, pokerComp, posX;\r\n        //var sortList = this._sortPokers();\r\n        var sortList = this.node.children;\r\n        //如果有牛，需要分隔开来\r\n        var offX = 0;\r\n        if(this._curResultNum > 0) offX = this._winPokerOff;\r\n        //开牌\r\n        for(var i = 0; i < this._list_pokers.length; i ++){\r\n            poker = this._list_pokers[i];\r\n            if(!poker) continue;\r\n            //poker.zIndex = index;\r\n            pokerComp = poker.getComponent(this._pokerCompName);\r\n            pokerComp.showPokerPlus();\r\n\r\n            if(!this._pokerW) this._setPokerConfigInfo(poker);\r\n            //posX = this._pokerShowPos.x+this._pokerW*0.5;\r\n            posX = this._pokerShowPos.x;\r\n            if(i > 2) posX += offX;\r\n            poker.position = cc.p(posX, this._pokerShowPos.y);\r\n            this._actOpenPoker(poker, index*this._pokerOffX);\r\n            index += 1;\r\n            lastPoker = poker;\r\n        }\r\n        lastPoker._callFunc = this._showResult.bind(this);\r\n        GG.audioMgr.playSound(16);\r\n    },\r\n    _actOpenPoker : function (poker, offX) {\r\n        var act1 = cc.moveTo(this._openMoveTime, poker.x+offX, poker.y);\r\n        poker.runAction(cc.sequence(act1, cc.callFunc(function (target) {\r\n            //this._showResult(5);\r\n            if(target._callFunc){\r\n                target._callFunc();\r\n                target._callFunc = null;\r\n            }\r\n        }, this)));\r\n    },\r\n    //显示卡牌的牌型结果\r\n    _showResult : function () {\r\n        var pokerResult = this._curResultNum;\r\n        var audioID = pokerResult == 0 ? 12 : pokerResult;\r\n        GG.audioMgr.playSound(audioID);\r\n\r\n        var pokerPos = cc.p(this._pokerShowPos.x+this._pokerW*0.65, this._pokerShowPos.y);\r\n        var result = cc.instantiate(this.prefab_pokerResult);\r\n        this.node.addChild(result, this.node.children.length);\r\n        result.getComponent(this._pokerResultCompName).showResult(pokerPos, pokerResult, true, this._showResultEnd.bind(this));\r\n\r\n\r\n        //var result = new cc.Node();\r\n        //var childrenNum = this.node.children.length;\r\n        //this.node.addChild(result, childrenNum);\r\n        //result.position = cc.p(this._pokerShowPos.x+this._pokerW*1, this._pokerShowPos.y-10)\r\n        //var sp = result.addComponent(cc.Sprite);\r\n        //var imgName;\r\n        //if(pokerResult < 1){\r\n        //    imgName = G_RES_URL.atlas_pokerResult.noResult;\r\n        //}else{\r\n        //    imgName = G_RES_URL.atlas_pokerResult.resultImgName+pokerResult;\r\n        //}\r\n        //sp.spriteFrame = this.atlas_pokerResult.getSpriteFrame(imgName);\r\n        //result.scale = 0;\r\n        //var act1 = cc.scaleTo(0.25, 0.7);\r\n        //var act2 = cc.scaleTo(0.1, 0.42);\r\n        //var act3 = cc.scaleTo(0.1, 0.5);\r\n        //result.runAction(cc.sequence(act1, act2, act3, cc.callFunc(this._showResultEnd, this)));\r\n\r\n        this._pokerResult = result;\r\n    },\r\n    _showResultEnd : function () {\r\n        if(this._callFunc){\r\n            this._callFunc();\r\n            this._callFunc = null;\r\n        }\r\n    },\r\n\r\n    //先按值大小，再依照花色排列   ======改服务端完成\r\n    //_sortPokers : function () {\r\n    //    var sortDict = {}, keyList = [], poker;\r\n    //    for(var key in this.node.children){\r\n    //        poker = this.node.children[key];\r\n    //        var pokerValue = poker.getComponent(this._pokerCompName).getPokerValue();\r\n    //        keyList.push(pokerValue);\r\n    //        if(!sortDict[pokerValue]) sortDict[pokerValue] = [poker];\r\n    //        else sortDict[pokerValue].push(poker);;\r\n    //    }\r\n    //\r\n    //    keyList = G_TOOL.quickSort(keyList);\r\n    //    var lastPoker, sortList = [], lastValue=null, curValue;\r\n    //    for(var key in keyList){\r\n    //        curValue = keyList[key];\r\n    //        poker = sortDict[curValue].pop();\r\n    //        if(lastValue != curValue){\r\n    //            sortList.splice(0, 0, poker);\r\n    //            lastPoker = poker;\r\n    //            lastValue = curValue;\r\n    //        }else{\r\n    //            if(!lastPoker) {\r\n    //                sortList.splice(0, 0, poker);\r\n    //                lastPoker = poker;\r\n    //            }else{\r\n    //                var lastType = lastPoker.getComponent(this._pokerCompName).getPokerType();\r\n    //                var curType = poker.getComponent(this._pokerCompName).getPokerType();\r\n    //                if(lastType >= curType){\r\n    //                    sortList.splice(0, 0, poker);\r\n    //                    lastPoker = poker;\r\n    //                }else if(lastType < curType){\r\n    //                    sortList.splice(1, 0, poker);\r\n    //                }\r\n    //                //else{\r\n    //                //    sortList.splice(0, 0, poker);\r\n    //                //    lastPoker = poker;\r\n    //                //}\r\n    //            }\r\n    //        }\r\n    //    }\r\n    //    return sortList\r\n    //},\r\n\r\n    _getTargetPos : function () {\r\n        //return cc.p(this._pokerShowPos.x + this._pokerOffX*this._pokerNum + this._pokerW*0.5, this._pokerShowPos.y)\r\n        return cc.p(this._pokerShowPos.x + this._pokerOffX*this._pokerNum, this._pokerShowPos.y)\r\n    },\r\n\r\n    _delOnePoker : function (pokerNode) {\r\n        //pokerNode.destroy();\r\n        pokerNode.getComponent(this._pokerCompName).clearAllActions();\r\n        pokerNode.getComponent(this._pokerCompName).showPokerNegative();\r\n        pokerNode.active = false;\r\n    },\r\n\r\n    getPokerNum : function () {\r\n        return this._pokerNum\r\n    },\r\n\r\n\r\n    // called every frame, uncomment this function to activate update callback\r\n    // update: function (dt) {\r\n\r\n    // },\r\n});\r\n"]}