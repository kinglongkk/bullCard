{"version":3,"sources":["assets\\Script\\Common\\Managers\\SocketCenter.js"],"names":["Number","isInteger","v","window","netBeanInited","undefined","NetBean","Object","Msg","pos","data","len","deepCount","initTime","NetServer","wsUrl","msgHandle","printMsg","timeDiff","getServerTime","Date","getTime","resetServerTime","serverTime","Math","min","prototype","isConnected","socket","readyState","WebSocket","OPEN","connect","MozWebSocket","netSrv","onmessage","event","obj","toObject","onOpen","byHandle","msgReceived","constructor","className","onopen","send","onclose","onClose","sendHeart","String","fromCharCode","Error","type","msg","toMsg","e","console","error","TYPE_NUM","TYPE_NUMS","TYPE_NUM_MAP","TYPE_STRING","TYPE_STRINGS","TYPE_STRING_MAP","TYPE_BOOL","TYPE_BOOLS","TYPE_BOOL_MAP","Type","collectionType","jsonClass","getMsg","fromServerData","m","TYPE_SINGLE","TYPE_ARRAY","TYPE_LIST","TYPE_MAP","loadJsons","getJson","index","jsonCount","getLong","i","t","getString","sendBy","fieldCount","fields","Array","types","requireds","j","fieldIndex","fieldType","classIndex","nbType","nb","putLong","o","mark","length","val","toFieldMsg","putByteOnMark","putString","putBoolean","dataType","putLongOnMark","log","fieldLen","getByte","jsonType","isObject","isMap","listLen","getFiled","key","getBoolean","getLen","charCodeAt","byteCount","positive","bit","tmp","parseInt","d","rs","rate","marks","push","pop","putByte","count","char","lenCount","start","substring","module","exports"],"mappings":"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","file":"unknown","sourcesContent":["if(!Number.isInteger)Number.isInteger=function(v){return \"number\"==typeof v&&(0|v)===v};\r\n\r\n//数据对象结构体，具体的属性将通过服务端来完善\r\n//socket对象\r\n//var WebSocket = WebSocket || window.WebSocket || window.MozWebSocket;\r\nif(window.netBeanInited == undefined || !window.netBeanInited){//只能初始化一次\r\n    window.NetBean = new Object();\r\n}\r\n/** 消息类,用来封装消息,解析消息 */\r\nvar Msg = function(){\r\n    this.pos=0;\r\n    this.data = \"\";\r\n    this.len = 0; //消息长度\r\n    this.deepCount = 0;//deepCount 用于object嵌套检测,>=10时不再解析\r\n}\r\nvar initTime = 1400000000;\r\nvar NetServer = function (wsUrl,msgHandle,printMsg){\r\n    this.wsUrl=wsUrl;this.msgHandle=msgHandle;this.printMsg=printMsg;\r\n    this.timeDiff = initTime;//时间差=当前时间-服务器时间\r\n    this.getServerTime=function(){\r\n        return new Date().getTime()-this.timeDiff;\r\n    }\r\n    this.resetServerTime= function(serverTime){\r\n        this.timeDiff = Math.min(this.timeDiff, new Date().getTime()-serverTime);\r\n    }\r\n}\r\n//网络服务是否已连接\r\nNetServer.prototype.isConnected = function(){\r\n    return this.socket && this.socket.readyState == WebSocket.OPEN;\r\n}\r\nNetServer.prototype.connect=function(){\r\n    if (!window.WebSocket) {\r\n        window.WebSocket = window.MozWebSocket;\r\n    }\r\n    if (window.WebSocket) {\r\n        this.socket = new WebSocket(this.wsUrl);\r\n        var netSrv = this;\r\n        this.socket.onmessage = function(event) {\r\n            //读取数据\r\n            var obj = Msg.toObject(event.data, netSrv);\r\n            if(obj==-1){\r\n                if(netSrv.onOpen){\r\n                    netSrv.onOpen();\r\n                }\r\n            }else{\r\n                // console.dir(obj);\r\n                // if(obj.constructor.className == \"NbTest\"){\r\n                //     netSrv.send(\"NbTest\", obj);\r\n                // }\r\n                var byHandle = true;\r\n                //夺宝大战通过下面代码注入接收消息,返回值表示是否由默认handle处理\r\n                // netSrv.msgReceived = function (className, obj) {\r\n                //     return false;\r\n                // }\r\n                if(netSrv.msgReceived){\r\n                    byHandle = netSrv.msgReceived(obj.constructor.className, obj);\r\n                }\r\n                //if(byHandle && netSrv.msgHandle[obj.constructor.className]){\r\n                //    netSrv.msgHandle[obj.constructor.className](obj);\r\n                //}\r\n                if(netSrv.printMsg){\r\n                    // console.log('\\n收到数据 event:'+obj.constructor.event +\" ,eventName:\"+ obj.constructor.className+',\\n' + TestUtil.objToStr(obj));\r\n                }\r\n            }\r\n        }\r\n        this.socket.onopen = function(event) {\r\n            this.send('0');//发送一个字节获取json\r\n        }\r\n        this.socket.onclose = function(event) {\r\n            if(netSrv.onClose){\r\n                netSrv.onClose();\r\n            }\r\n        }\r\n        return this;\r\n    } else {\r\n        return undefined;\r\n    }\r\n}\r\n/** 发送心跳消息 */\r\nNetServer.prototype.sendHeart=function() {\r\n    if (this.socket.readyState == WebSocket.OPEN) {\r\n        this.socket.send(String.fromCharCode(9));\r\n        return true;\r\n    } else {\r\n        throw new Error(\"Disconnect from Server,Please try again...\");\r\n    }\r\n}\r\n\r\nNetServer.prototype.send=function(type, obj) {\r\n    if (this.socket.readyState == WebSocket.OPEN) {\r\n        try{\r\n            var msg = Msg.toMsg(type, obj);\r\n            this.socket.send(msg);\r\n        }catch(e){\r\n            console.error(e);\r\n        }\r\n        return true;\r\n    } else {\r\n        throw new Error(\"Disconnect from Server,Please try again...\");\r\n    }\r\n}\r\n/** 数据类型,名称后面带S为列表,MAP为map或对象,必须为奇数,单数据则为偶数 */\r\nMsg.TYPE_NUM=0,Msg.TYPE_NUMS=1,Msg.TYPE_NUM_MAP=2,\r\n    Msg.TYPE_STRING=4,Msg.TYPE_STRINGS=5,Msg.TYPE_STRING_MAP=6,\r\n    Msg.TYPE_BOOL=8,Msg.TYPE_BOOLS=9,Msg.TYPE_BOOL_MAP=10;\r\nMsg.Type = function (collectionType, jsonClass) {\r\n    this.collectionType = collectionType;\r\n    this.jsonClass = jsonClass;\r\n    return this;\r\n}\r\n\r\nMsg.getMsg = function (fromServerData){\r\n    var m = new Msg();\r\n    m.data=fromServerData;\r\n    return m;\r\n}\r\n\r\nvar TYPE_SINGLE = 0,TYPE_ARRAY = 1,TYPE_LIST = 2,TYPE_MAP = 3;\r\nMsg.prototype.loadJsons = function (netSrv){\r\n    var getJson = function(index){\r\n        if(!NetBean[index])NetBean[index] = function(){ return this;}\r\n        return NetBean[index];\r\n    }\r\n    var jsonCount = this.getLong();\r\n    for(var i = 0; i<jsonCount; i++){\r\n        var index = this.getLong();\r\n        var t = getJson(index);\r\n        t.event=index;\r\n        t.className=this.getString();\r\n        t.sendBy=this.getLong();\r\n        NetBean[t.className] = t;\r\n        var fieldCount = this.getLong();\r\n        t.fields = new Array();\r\n        t.types = new Array();\r\n        t.requireds = new Array();\r\n        for(var j = 0; j<fieldCount; j++){\r\n            var fieldIndex = this.getLong();\r\n            t.requireds[fieldIndex]=this.getLong()==1;\r\n            t.fields[fieldIndex]=this.getString();\r\n            var collectionType = this.getLong();\r\n            var fieldType = this.getLong();\r\n            if(fieldType<8){//基本数据类型\r\n                fieldType = fieldType*4 + collectionType;\r\n                t.types[fieldIndex] = fieldType;\r\n            }else{\r\n                t.types[fieldIndex] = new Msg.Type(collectionType,getJson(fieldType-8));\r\n            }\r\n        }\r\n    }\r\n    window.netBeanInited = true;\r\n}\r\n\r\nMsg.toObject = function (fromServerData, netSrv){\r\n    var msg = Msg.getMsg(fromServerData);\r\n    var serverTime = msg.getLong();\r\n    netSrv.resetServerTime(serverTime);\r\n    var classIndex = msg.getLong();\r\n    if(classIndex==-1){\r\n        msg.loadJsons(netSrv);\r\n        return -1;\r\n    }\r\n    return msg.toObject(NetBean[classIndex]);\r\n}\r\n\r\nMsg.toMsg = function (nbType, obj){\r\n    var msg = new Msg();\r\n    var nb = NetBean[nbType];\r\n    msg.putLong(nb.event);\r\n    msg.toMsg(nb, obj);\r\n    return msg.data;\r\n}\r\n\r\nMsg.prototype.toMsg = function (nb, o){\r\n    var fieldCount=0;\r\n    this.mark();//fieldCount\r\n    var types = nb.types, fields = nb.fields,requireds = nb.requireds;\r\n    for (var i = 0; i < fields.length; i ++) {\r\n        var val = o[fields[i]];\r\n        if(val == undefined || val == null){\r\n            if(requireds[i]){\r\n                throw new Error(\"required的值不能为空,NetBean.\"+nb.className+\".\"+nb.fields[i]);\r\n            }\r\n            continue;\r\n        }\r\n        fieldCount ++;\r\n        this.putLong(i);\r\n        var error = this.toFieldMsg(types[i], val);\r\n        if(error != null){\r\n            throw new Error(\"变量赋值错误,NetBean.\"+nb.className+\".\"+nb.fields[i]\r\n                +\"=\"+val+\",数据类型应该为:\"+error);\r\n        }\r\n    }\r\n    this.putByteOnMark(fieldCount);\r\n}\r\n\r\nMsg.prototype.toFieldMsg = function (type, val) {\r\n    switch (type) {\r\n        case Msg.TYPE_NUM:\r\n            if(!Number.isInteger(val))return \"数字整型\";\r\n            this.putLong(val);\r\n            break;\r\n        case Msg.TYPE_STRING:\r\n            if(typeof val != \"string\")return \"字符串类型\";\r\n            this.putString(val);\r\n            break;\r\n        case Msg.TYPE_BOOL:\r\n            if(typeof val != \"boolean\")return \"布尔类型\";\r\n            this.putBoolean(val);\r\n            break;\r\n        default: {\r\n            var collectionType = TYPE_SINGLE;\r\n            var dataType = Msg.TYPE_NUM;\r\n            if(typeof type == \"number\"){\r\n                collectionType = type&3;\r\n                dataType = type-collectionType;\r\n            }else{\r\n                collectionType = type.collectionType;\r\n                dataType = -1;\r\n            }\r\n            switch(collectionType){\r\n                case TYPE_SINGLE:{\r\n                    this.toMsg(type, val);\r\n                }break;\r\n                case TYPE_MAP: {\r\n                    this.mark();\r\n                    var len = 0;\r\n                    for (var j in val) {\r\n                        this.toFieldMsg(Msg.TYPE_STRING, j+\"\");\r\n                        if(dataType!=-1){\r\n                            this.toFieldMsg(dataType, val[j]);\r\n                        }else{\r\n                            this.toMsg(type.jsonClass, val[j]);\r\n                        }\r\n                        len ++;\r\n                    }\r\n                    this.putLongOnMark(val.length);\r\n                }break;\r\n                default: {//Array\r\n                    this.putLong(val.length);\r\n                    for (var j in val) {\r\n                        if(dataType!=-1){\r\n                            this.toFieldMsg(dataType, val[j]);\r\n                        }else{\r\n                            this.toMsg(type.jsonClass, val[j]);\r\n                        }\r\n                    }\r\n                };\r\n            }\r\n            break;\r\n        }\r\n    }\r\n    return null;\r\n}\r\n\r\n/**\r\n * @param jsonClass Json对应的类\r\n * @returns 消息转换的对象\r\n */\r\nMsg.prototype.toObject = function (jsonClass){\r\n    var obj;\r\n    try{\r\n        obj = new jsonClass();\r\n    }catch (e){\r\n        console.log(e);\r\n    }\r\n    var fieldLen = this.getByte();\r\n    for(var i = 0; i < fieldLen; i++){//获取fieldIndex,再获取变量值的模式\r\n        var fieldIndex = this.getLong();\r\n        var jsonType = jsonClass.types[fieldIndex];\r\n        var isObject = typeof jsonType != 'number';\r\n        if((!isObject && (jsonType&3!=0)) || (isObject && jsonType.collectionType != TYPE_SINGLE)) {//奇数,列表,先读取数量\r\n            var isMap = false;\r\n            if(!isObject){\r\n                if((jsonType & 3) == 3) isMap = true;\r\n                jsonType = jsonType - (jsonType&3);\r\n            }else{\r\n                isMap = jsonType.collectionType == TYPE_MAP;\r\n            }\r\n            var listLen = this.getFiled(Msg.TYPE_NUM);\r\n            if(!isMap){\r\n                obj[jsonClass.fields[fieldIndex]] = new Array();\r\n            }else{\r\n                obj[jsonClass.fields[fieldIndex]] = {};\r\n            }\r\n            for(var j = 0; j < listLen; j++){\r\n                var key = isMap ? this.getFiled(Msg.TYPE_STRING) : j;\r\n                obj[jsonClass.fields[fieldIndex]][key]=this.getFiled(jsonType);\r\n            }\r\n        }else{\r\n            obj[jsonClass.fields[fieldIndex]]=this.getFiled(jsonType);\r\n        }\r\n    }\r\n    return obj;\r\n}\r\n\r\nMsg.prototype.getFiled = function (jsonType){\r\n    switch(jsonType){\r\n        case Msg.TYPE_NUM:\r\n            return this.getLong();\r\n            break;\r\n        case Msg.TYPE_STRING:\r\n            return this.getString();\r\n            break;\r\n        case Msg.TYPE_BOOL:\r\n            return this.getBoolean();\r\n            break;\r\n        default:\r\n            return this.toObject(jsonType.jsonClass);\r\n            break;\r\n    }\r\n}\r\n\r\nMsg.prototype.getLen = function(){\r\n    var len = this.data.charCodeAt(this.pos++);\r\n    var byteCount = (len>>4)&7;\r\n    len=len&15;\r\n    for(var i=0;i<byteCount;i++){\r\n        len = len | ( this.data.charCodeAt(this.pos++)<<(i*7+4))\r\n    }\r\n    return len+this.pos;\r\n}\r\n\r\nMsg.prototype.putLong = function(val){\r\n    var positive = val>0;\r\n    if(!positive)val=val*-1;\r\n    var bit = 0; var tmp = val;\r\n    while(tmp>0){\r\n        tmp=parseInt(tmp/2);\r\n        bit++;\r\n    }\r\n    bit = parseInt((bit+3)/7);\r\n    this.data += String.fromCharCode((bit<<4)|((positive?0:1)<<3) | (val&7));//高1-3多余byte数，低4位正0(负1)，低1-3位数据最低3位\r\n    val=parseInt(val/(1<<3));\r\n    for (var i = 0; i < bit; i++) {\r\n        this.data+=String.fromCharCode(val&127);\r\n        val = parseInt(val/(1<<7));\r\n    }\r\n}\r\n\r\nMsg.prototype.getLong = function(){\r\n    var d = this.data.charCodeAt(this.pos++);\r\n    var rs = d&7;\r\n    var byteCount = (d>>4)&7;\r\n    var rate = 1<<3;//用乘法代替位移避免溢出\r\n    for (var i = 0; i < byteCount; i++) {\r\n        rs = rs+((this.data.charCodeAt(this.pos++)&255)*rate);\r\n        rate *= (1<<7);\r\n    }\r\n    rs = rs*((d&8)==0?1:-1);\r\n    return rs;\r\n}\r\n\r\nMsg.prototype.mark = function(){\r\n    if(!this.marks)this.marks = new Array();\r\n    this.marks.push(this.data);\r\n    this.data =\"\";\r\n}\r\n\r\nMsg.prototype.putByteOnMark = function(val){\r\n    this.data = this.marks.pop()+String.fromCharCode(val&127)+this.data;\r\n}\r\n\r\nMsg.prototype.putLongOnMark = function(val){\r\n    var rs = this.marks.pop();\r\n    var positive = val>0;\r\n    if(!positive)val=val*-1;\r\n    var bit = 0; var tmp = val;\r\n    while(tmp>0){\r\n        tmp=parseInt(tmp/2);\r\n        bit++;\r\n    }\r\n    bit = parseInt((bit+3)/7);\r\n    rs += String.fromCharCode((bit<<4)|((positive?0:1)<<3) | (val&7));//高1-3多余byte数，低4位正0(负1)，低1-3位数据最低3位\r\n    val=parseInt(val/(1<<3));\r\n    for (var i = 0; i < bit; i++) {\r\n        rs+=String.fromCharCode(val&127);\r\n        val = parseInt(val/(1<<7));\r\n    }\r\n    this.data = rs + this.data;\r\n}\r\n\r\nMsg.prototype.putByte = function(val){\r\n    return this.data+=String.fromCharCode(val&127);\r\n}\r\n\r\nMsg.prototype.getByte = function(){\r\n    return this.data.charCodeAt(this.pos++)&127;\r\n}\r\nMsg.prototype.putBoolean = function(val){\r\n    return this.data+=String.fromCharCode(val?1:0);\r\n}\r\n\r\nMsg.prototype.getBoolean = function(){\r\n    return this.data.charCodeAt(this.pos++)==1;\r\n}\r\n\r\nMsg.prototype.putString=function(val){\r\n    var count = 0;\r\n    for(var i=0;i<val.length;i++){\r\n        var char = val.charCodeAt(i);\r\n        if(char<0x7f){\r\n            count+=1;\r\n        }else if(char<=0x7ff){\r\n            count+=2;\r\n        }else if(char<=0xFFFF){\r\n            count+=3;\r\n        }else {\r\n            count+=4;\r\n        }\r\n    }\r\n    var bit = 0,tmp = count;\r\n    while(tmp>0){\r\n        tmp=tmp>>1;\r\n        bit++;\r\n    }\r\n    bit = parseInt((bit+2)/7);\r\n    tmp = count;\r\n    this.data+=String.fromCharCode((bit<<5) | (tmp&31));\r\n    tmp = tmp>>5;\r\n    for (var i = 0; i < bit; i++) {\r\n        this.data+=String.fromCharCode(tmp&127);\r\n        tmp = tmp>>7;\r\n    }\r\n    this.len+=count-val.length;\r\n    this.data+=val;\r\n}\r\n\r\nMsg.prototype.getString=function(){\r\n    var d =  this.data.charCodeAt(this.pos++);\r\n    var lenCount = (d>>5)&3;//高2位字节数\r\n    var byteCount = d&31;\r\n    for (var i = 0; i < lenCount; i++) {\r\n        byteCount = byteCount|((this.data.charCodeAt(this.pos++)&255)<<(i*7+5));\r\n    }\r\n    if(byteCount==0)return \"\";\r\n    var count = 0,start=this.pos;\r\n    for(var i = this.pos; i< this.data.length;i++){\r\n        var char = this.data.charCodeAt(this.pos++);\r\n        if(char<0x7f){\r\n            count+=1;\r\n        }else if(char<=0x7ff){\r\n            count+=2;\r\n        }else if(char<=0xFFFF){\r\n            count+=3;\r\n        }else {\r\n            count+=4;\r\n        }\r\n        if(count>=byteCount){\r\n            break;\r\n        }\r\n    }\r\n    return this.data.substring(start,this.pos);\r\n}\r\nmodule.exports = NetServer;"]}