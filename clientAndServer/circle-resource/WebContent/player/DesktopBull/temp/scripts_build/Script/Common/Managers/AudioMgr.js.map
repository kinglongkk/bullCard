{"version":3,"sources":["assets\\Script\\Common\\Managers\\AudioMgr.js"],"names":["audioMgr","cc","Class","ctor","_musicVolume","_soundVolume","_dict_audioConfig","_bgMusicID","_bgMusicName","_isReloadPlatform","_isReloadGame","_reloadPlatformURL","_reloadGameRoomURL","_dict_audioUrl","_environmentConfirm","playMusic","audioID","musicName","getAudioName","audioEngine","stop","url","getAudio","play","playSound","setMusicVolume","num","setSoundVolume","stopAudio","stopMusic","audioName","raw","G_TOOL","formatStr","G_RES_URL","audioUrl","getIsPlayMusic","getAudioConfig","setAudioConfig","dict","music","sound","saveMusicConfig","isPlay","saveSoundConfig","tableObj","GG","tableMgr","getTable","dict_tablesName","data","getDataByID","reloadPlatformAudio","callBack","self","loader","loadResDir","err","audioList","isOk","urlEnd","i","length","substring","lastIndexOf","split","reloadGameAudio","getIsReloadPlatform","getIsReloadGame","sys","isNative","audio","Audio","canPlayType","module","exports"],"mappings":"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","file":"unknown","sourcesContent":["//音效管理器\r\n// music 是音乐； sound是音效\r\nvar audioMgr = cc.Class({\r\n    ctor : function () {\r\n        this._musicVolume = 1;                                                    //音乐音量大小\r\n        this._soundVolume = 1;                                                    //音效音量大小\r\n        //this._dict_audioConfig = {'music':true,'sound':true};                  //音乐音效的配置\r\n        this._dict_audioConfig = null;                                             //音乐音效的配置\r\n        this._bgMusicID = -1;                                                      //背景音乐\r\n        this._bgMusicName = null;                                                 //背景音乐\r\n        this._isReloadPlatform = false;                                            //是否已经加载大厅音效\r\n        this._isReloadGame = false;                                                //是否已经加载游戏房间音效\r\n        this._reloadPlatformURL = '';                                              //使用音频格式的加载路劲\r\n        this._reloadGameRoomURL = '';                                              //使用音频格式的加载路劲\r\n        this._dict_audioUrl = {};                                                   //存放所有音效的名字对应路径\r\n        //环境检测\r\n        this._environmentConfirm();\r\n    },\r\n\r\n    //播放音乐\r\n    playMusic : function (audioID) {\r\n        if(!audioID) audioID = 19;\r\n        var musicName = this.getAudioName(audioID);\r\n        if(this._musicVolume <= 0){\r\n            //暂停音乐\r\n            if(this._bgMusicName) {\r\n                cc.audioEngine.stop(this._bgMusicID);\r\n                this._bgMusicName = null;\r\n            }\r\n        }else{\r\n            //开启音乐\r\n            if(musicName){\r\n                if(this._bgMusicName !== musicName) {\r\n                    //换音乐\r\n                    this._bgMusicName = musicName;\r\n                    var url = this.getAudio(this._bgMusicName);\r\n                    //console.log('播放背景音乐'+url)\r\n                    this._bgMusicID = cc.audioEngine.play(url, true);\r\n                    //this._bgMusicID = cc.audioEngine.playMusic(url, true);\r\n                }\r\n            }else{\r\n                //if(this._bgMusicName) {\r\n                //    //播放上次的音乐\r\n                //    cc.audioEngine.resume(this._bgMusicID);\r\n                //}\r\n            }\r\n        }\r\n    },\r\n\r\n    //播放音效\r\n    playSound : function (audioID) {\r\n        if(this._soundVolume <= 0) return;\r\n        var url = this.getAudio(this.getAudioName(audioID));\r\n        //console.log('播放音效'+url);\r\n        return cc.audioEngine.play(url, false);\r\n        //return cc.audioEngine.playEffect(url, false);\r\n    },\r\n\r\n    //调整音乐大小\r\n    setMusicVolume : function (num) {\r\n        this._musicVolume = num;\r\n        this.playMusic();\r\n    },\r\n\r\n    //调整音效大小\r\n    setSoundVolume : function (num) {\r\n        this._soundVolume = num;\r\n    },\r\n\r\n    //停止某个音效\r\n    stopAudio : function (audioID) {\r\n        cc.audioEngine.stop(audioID);\r\n    },\r\n\r\n    //停止音乐\r\n    stopMusic : function () {\r\n        if(this._bgMusicName) {\r\n            cc.audioEngine.stop(this._bgMusicID);\r\n            this._bgMusicName = null;\r\n        }\r\n    },\r\n\r\n    //获取音频文件\r\n    getAudio : function (audioName) {\r\n        if(!this._dict_audioUrl[audioName]) return cc.url.raw(G_TOOL.formatStr(G_RES_URL.audioUrl, audioName));\r\n        return this._dict_audioUrl[audioName]\r\n    },\r\n\r\n    //获取音乐是否正在播放\r\n    getIsPlayMusic : function () {\r\n        if(this._bgMusicName && this._musicVolume > 0) return true\r\n        return false\r\n    },\r\n\r\n    //=====================================\r\n    //获取音效配置\r\n    getAudioConfig : function () {\r\n        return this._dict_audioConfig\r\n    },\r\n    //设置音效配置\r\n    setAudioConfig : function (dict) {\r\n        this.setMusicVolume(dict.music ? 1 : 0);\r\n        this.setSoundVolume(dict.sound ? 1 : 0);\r\n        this._dict_audioConfig = dict;\r\n    },\r\n    //保存音乐配置\r\n    saveMusicConfig : function (isPlay) {\r\n        this.setMusicVolume(isPlay ? 1 : 0);\r\n        this._dict_audioConfig.music = isPlay;\r\n    },\r\n    //保存音效配置\r\n    saveSoundConfig : function (isPlay) {\r\n        this.setSoundVolume(isPlay ? 1 : 0);\r\n        this._dict_audioConfig.sound = isPlay;\r\n    },\r\n    //=====================================\r\n    //获取某个音频的名字\r\n    getAudioName : function (audioID) {\r\n        var tableObj = GG.tableMgr.getTable(G_RES_URL.dict_tablesName.audioName);\r\n        var data = tableObj.getDataByID(audioID);\r\n        if(data) return data.audioName;\r\n        return null\r\n    },\r\n\r\n    //预加载音频资源\r\n    //reloadAudio : function (callBack) {\r\n    //    var self = this;\r\n    //    cc.loader.loadResDir('Sounds', function (err, audioList) {\r\n    //        var isOk = false;\r\n    //        if(!err){\r\n    //            var content = audioList[0];\r\n    //            var index = content.lastIndexOf('/');\r\n    //            self._basePlatformUrl = content.substring(0, index+1)+self._audioFormatStr;\r\n    //            isOk = true;\r\n    //        }else {\r\n    //            //加载音效发生问题\r\n    //        }\r\n    //        if(callBack){\r\n    //            callBack(isOk);\r\n    //            callBack = null;\r\n    //        }\r\n    //    })\r\n    //},\r\n\r\n    //加载大厅音效\r\n    reloadPlatformAudio : function (callBack) {\r\n        var self = this;\r\n        cc.loader.loadResDir(this._reloadPlatformURL, function (err, audioList) {\r\n            var isOk = false;\r\n            if(!err){\r\n                var audioUrl, urlEnd,audioName;\r\n                for(var i = 0; i < audioList.length; i ++){\r\n                    audioUrl = audioList[i]\r\n                    urlEnd = audioUrl.substring(audioUrl.lastIndexOf('/')+1, audioUrl.length);\r\n                    audioName = urlEnd.split('.')[0];\r\n                    self._dict_audioUrl[audioName] = audioUrl;\r\n                }\r\n                self._isReloadPlatform = true;\r\n            }else {\r\n                //加载音效发生问题\r\n            }\r\n            if(callBack){\r\n                callBack(isOk);\r\n                callBack = null;\r\n            }\r\n        })\r\n    },\r\n\r\n    //加载游戏房间内的音效\r\n    reloadGameAudio : function (callBack) {\r\n        var self = this;\r\n        cc.loader.loadResDir(this._reloadGameRoomURL, function (err, audioList) {\r\n            if(!err){\r\n                //没有加载错误\r\n                var audioUrl, urlEnd,audioName;\r\n                for(var i = 0; i < audioList.length; i ++){\r\n                    audioUrl = audioList[i]\r\n                    urlEnd = audioUrl.substring(audioUrl.lastIndexOf('/')+1, audioUrl.length);\r\n                    audioName = urlEnd.split('.')[0];\r\n                    self._dict_audioUrl[audioName] = audioUrl;\r\n                }\r\n                self._isReloadGame = true;\r\n            }\r\n            if(callBack){\r\n                callBack();\r\n                callBack = null;\r\n            }\r\n        })\r\n    },\r\n    getIsReloadPlatform : function () {\r\n        return this._isReloadPlatform\r\n    },\r\n    getIsReloadGame : function () {\r\n        return this._isReloadGame\r\n    },\r\n\r\n    //平台鉴定\r\n    _environmentConfirm : function () {\r\n        //switch (cc.sys.os){\r\n        //    case cc.sys.OS_ANDROID:\r\n        //        //android手机用ogg\r\n        //        //this._reloadPlatformURL = 'Sounds/ogg_platform';\r\n        //        //this._reloadGameRoomURL = 'Sounds/ogg_gameRoom';\r\n        //        this._reloadPlatformURL = 'Sounds/mp3_platform';\r\n        //        this._reloadGameRoomURL = 'Sounds/mp3_gameRoom';\r\n        //        break\r\n        //    case cc.sys.OS_IOS:\r\n        //        //ios手机用mp3\r\n        //        this._reloadPlatformURL = 'Sounds/mp3_platform';\r\n        //        this._reloadGameRoomURL = 'Sounds/mp3_gameRoom';\r\n        //        break\r\n        //    default:\r\n        //        break\r\n        //}\r\n        if(cc.sys.isNative){\r\n            this._reloadPlatformURL = 'Sounds/mp3_platform';\r\n            this._reloadGameRoomURL = 'Sounds/mp3_gameRoom';\r\n        }else{\r\n            var audio = new Audio();\r\n            if(audio.canPlayType(\"audio/mp3\")){\r\n                this._reloadPlatformURL = 'Sounds/mp3_platform';\r\n                this._reloadGameRoomURL = 'Sounds/mp3_gameRoom';\r\n            }else if(audio.canPlayType(\"audio/ogg\")){\r\n                this._reloadPlatformURL = 'Sounds/ogg_platform';\r\n                this._reloadGameRoomURL = 'Sounds/ogg_gameRoom';\r\n            }\r\n        }\r\n    },\r\n\r\n    // releaseAudio : function () {\r\n    //     cc.loader.release(cc.url.raw(\"resources/sounds/\" + url));\r\n    // }\r\n})\r\n\r\nmodule.exports = audioMgr;"]}